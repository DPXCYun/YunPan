{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  data() {\n    return {\n      show: false,\n      tableData: this.$global_msg.disk,\n      pathArr: [],\n      imgUrl: \"\",\n      dialogVisible: false,\n      fileUrl: '',\n      // ğŸ‘‡ æ–°å¢ï¼šä¸Šä¼ çŠ¶æ€å’Œè¿›åº¦\n      uploading: false,\n      uploadProgress: 0,\n      files: [] // ğŸ‘ˆ æ–°å¢ï¼šç”¨äºå­˜å‚¨é€‰ä¸­çš„å¤šä¸ªæ–‡ä»¶\n    };\n  },\n\n  computed: {\n    //ç»è¿‡æ‹¼æ¥çš„é¢åŒ…å±‘ç›®å½•\n    pathString: function () {\n      var pstr = \"/\";\n      if (this.pathArr.length === 0) {\n        return pstr;\n      }\n      for (var i = 0; i < this.pathArr.length; i++) {\n        var tempStr = this.pathArr[i] + \"/\";\n        pstr += tempStr;\n      }\n      return pstr;\n    }\n  },\n  _methods: {\n    copy() {\n      const textarea = document.getElementById('textarea');\n      navigator.clipboard.writeText(textarea.value).then(() => this.$alert(\"å¤åˆ¶æˆåŠŸï¼\")).catch(err => console.error('å¤åˆ¶å¤±è´¥', err));\n    },\n    // copy(){\n    //   var content = document.getElementById('textarea').innerHTML;\n    //\n    //   navigator.clipboard.writeText(content)\n    //   .then(() => {\n    //     this.$alert(\"å¤åˆ¶æˆåŠŸï¼\")\n    //   })\n    //   .catch(err => {\n    //   console.log('Something went wrong', err);\n    //   })\n    // },\n\n    //è¿”å›ä¸Šçº§ç›®å½•\n    returnToLastDir() {\n      this.updateFolderSize();\n      if (this.pathArr.length === 0) {\n        this.$message.info(\"å·²ç»åˆ°è¾¾æ ¹ç›®å½•\");\n        return;\n      }\n      this.pathArr.pop();\n      //todo:æ›´æ–°å†…å®¹\n      var url = 'http://localhost:8989/getFilesAndFolders?path=' + this.pathString;\n      this.axios({\n        method: 'GET',\n        url: url\n      }).then(resp => {\n        let data = resp.data;\n        console.log(data);\n        if (data.success) {\n          this.tableData = data.data.fileList;\n        }\n      });\n    },\n    //ç‚¹å…¥æ–‡ä»¶å¤¹\n    enterNextDir(row) {\n      this.updateFolderSize();\n      console.log(row);\n      var tempStr = row.fileName;\n      this.pathArr.push(tempStr);\n      //todoï¼šæ›´æ–°å†…å®¹\n      var url = 'http://localhost:8989/getFilesAndFolders?path=' + this.pathString;\n      this.axios({\n        method: 'GET',\n        url: url\n      }).then(resp => {\n        let data = resp.data;\n        console.log(data);\n        if (data.success) {\n          this.tableData = data.data.fileList;\n        }\n      });\n    },\n    //æ–‡ä»¶åˆ†äº«\n    shareFile(row) {\n      if (row.isfolder === 1) {\n        this.$message.warning(\"æš‚æ—¶ä¸æ”¯æŒåˆ†äº«æ–‡ä»¶å¤¹å†…å®¹\");\n        return;\n      }\n      var that = this;\n      //è¯·æ±‚tokenï¼Œç”±äºå¼‚æ­¥çš„å…³ç³»ï¼Œåœ¨å¼¹çª—å¼¹å‡ºæ¥ä¹‹å‰è¦æ”¹å®Œæ•°æ®ï¼Œæ‰€æœ‰è¿™æ®µæ”¾å‰é¢ï¼Œæ”¶å›¾ç‰‡è‚¯å®šæ¯”æ”¶å­—ç¬¦ä¸²æ…¢\n\n      // this.$loading(\"loading\");//æ˜¾ç¤ºæ­£åœ¨åŠ è½½\n      //æ¥ä¸‹æ¥çš„é€»è¾‘ä¸ºï¼Œå‘èµ·è¯·æ±‚ï¼ŒæˆåŠŸåŠ è½½/åŠ è½½å¤±è´¥\n      console.log(sessionStorage.getItem(\"saToken\"));\n      var url = \"http://localhost:8989/fileShare/createQRCode1?fileId=\" + row.id;\n      this.$axios({\n        url: url,\n        method: \"GET\",\n        headers: {\n          'satoken': sessionStorage.getItem(\"saToken\")\n        },\n        responseType: \"blob\"\n      }).then(function (res) {\n        console.log(\"è¯·æ±‚å‘èµ·æˆåŠŸ\");\n        console.log(res);\n        var typeArray = res.data;\n        var blob = new Blob([typeArray], {\n          type: res.headers['Content-Type']\n        });\n        var url = window.URL.createObjectURL(blob);\n        while (1) {\n          console.log(\"è¿˜æœªè·å¾—url\");\n          if (url != '') {\n            console.log(\"è·å¾—urläº†\");\n            console.log(url);\n            that.imgUrl = url;\n            that.$axios({\n              url: \"http://localhost:8989/getShareCode?fileId=\" + row.id,\n              method: \"GET\",\n              headers: {\n                'satoken': sessionStorage.getItem(\"saToken\")\n              }\n            }).then(res => {\n              console.log(res);\n              var token = res.data.data[\"access_token\"];\n              that.fileUrl = \"http://localhost:8989/publicDownload?access_token=\" + token;\n              that.dialogVisible = true;\n            });\n            break;\n          }\n        }\n        // var imgHtmlString = \"<image src='\" + url + \"'>\";\n        //å¼¹çª—\n        // that.$alert('<strong>æ‚¨çš„åˆ†äº«äºŒç»´ç ï¼š</strong>' +\n        //     \"<image width='390' height='200' src='\" + url + \"'>\" +\n        //     '<strong>æ‚¨çš„æ–‡ä»¶ä¸‹è½½åœ°å€ï¼š</strong>', 'åˆ†äº«è¯¦æƒ…', {\n        //   dangerouslyUseHTMLString: true\n        // });\n      });\n    },\n\n    // æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶é‡å‘½å\n    handleEdit_(row) {\n      this.$prompt('ä¿®æ”¹æ–‡ä»¶å', 'æç¤º', {\n        confirmButtonText: 'ç¡®å®š',\n        cancelButtonText: 'å–æ¶ˆ'\n      }).then(({\n        value\n      }) => {\n        if (value == null) {\n          this.$message({\n            type: 'info',\n            message: \"è¾“å…¥ä¸èƒ½ä¸ºç©º\"\n          });\n          return;\n        }\n        this.axios({\n          method: 'PUT',\n          url: 'http://localhost:8989/rename',\n          data: {\n            folderId: row.id,\n            newFolderName: value\n          }\n        }).then(resp => {\n          let data = resp.data;\n          if (data.success) {\n            this.getFileAndFolder();\n            this.$message({\n              type: 'success',\n              message: data.message\n            });\n          } else {\n            this.$message({\n              type: 'info',\n              message: data.message\n            });\n          }\n        });\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: 'å–æ¶ˆè¾“å…¥'\n        });\n      });\n    },\n    //ç§»åŠ¨æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶\n    moveFile(row) {\n      console.log(row);\n      this.$prompt('è¾“å…¥è¦ç§»åŠ¨çš„è·¯å¾„ï¼Œæ ¼å¼: /**/**/', 'ç§»åŠ¨åˆ°', {\n        confirmButtonText: 'ç¡®å®š',\n        cancelButtonText: 'å–æ¶ˆ'\n      }).then(({\n        value\n      }) => {\n        if (value == null) {\n          this.$message({\n            type: 'info',\n            message: \"è¾“å…¥ä¸èƒ½ä¸ºç©º\"\n          });\n          return;\n        }\n        if (this.pathString == value) {\n          this.$message({\n            type: 'info',\n            message: \"å·²åœ¨å½“å‰æ–‡ä»¶å¤¹\"\n          });\n          return;\n        }\n        this.axios({\n          method: 'PUT',\n          url: 'http://localhost:8989/move',\n          data: {\n            folderId: row.id,\n            newPath: value\n          }\n        }).then(resp => {\n          let data = resp.data;\n          if (data.success) {\n            this.getFileAndFolder();\n            this.$message({\n              type: 'success',\n              message: data.message\n            });\n          } else {\n            this.$message({\n              type: 'info',\n              message: data.message\n            });\n          }\n        });\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: 'å–æ¶ˆè¾“å…¥'\n        });\n      });\n    },\n    updateFolderSize() {\n      this.axios({\n        method: 'GET',\n        url: 'http://localhost:8989/getFolderSize?path=' + this.pathString\n      });\n    },\n    // è·å–è·¯å¾„ä¸‹æ–‡ä»¶å’Œæ–‡ä»¶å¤¹\n    getFileAndFolder() {\n      var url = 'http://localhost:8989/getFilesAndFolders?path=' + this.pathString;\n      this.axios({\n        method: 'GET',\n        url: url\n      }).then(resp => {\n        let data = resp.data;\n        console.log(data);\n        if (data.success) {\n          this.tableData = data.data.fileList;\n        }\n      });\n    },\n    // åˆ›å»ºæ–‡ä»¶å¤¹\n    createDir() {\n      this.$prompt('è¾“å…¥æ–‡ä»¶å¤¹ç›®å½•', 'æç¤º', {\n        confirmButtonText: 'ç¡®å®š',\n        cancelButtonText: 'å–æ¶ˆ'\n      }).then(({\n        value\n      }) => {\n        if (value == null) {\n          this.$message({\n            type: 'info',\n            message: \"è¾“å…¥ä¸èƒ½ä¸ºç©º\"\n          });\n          return;\n        }\n        this.axios({\n          method: 'POST',\n          url: 'http://localhost:8989/createFolder',\n          data: {\n            path: this.pathString,\n            folderName: value\n          }\n        }).then(resp => {\n          let data = resp.data;\n          if (data.success) {\n            this.getFileAndFolder();\n            this.$message({\n              type: 'success',\n              message: data.message\n            });\n          } else {\n            this.$message({\n              type: 'info',\n              message: data.message\n            });\n          }\n        });\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: 'å–æ¶ˆè¾“å…¥'\n        });\n      });\n    },\n    // åˆ é™¤æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶\n    deleteFile_(row, index) {\n      if (confirm(\"æ˜¯å¦åˆ é™¤ï¼\")) {\n        this.axios({\n          method: 'DELETE',\n          url: 'http://localhost:8989/delete',\n          data: {\n            fileId: row.id\n          }\n        }).then(resp => {\n          let data = resp.data;\n          if (data.success) {\n            this.tableData.splice(index, 1);\n            this.$message({\n              type: 'success',\n              message: data.message\n            });\n          } else {\n            this.$message({\n              type: 'info',\n              message: data.message\n            });\n          }\n        });\n      } else {\n        this.$message({\n          type: 'info',\n          message: 'å–æ¶ˆåˆ é™¤'\n        });\n      }\n    },\n    getFile(event) {\n      this.files = Array.from(event.target.files); // âœ… è½¬ä¸ºæ•°ç»„ï¼Œä¾¿äºåç»­å¤„ç†\n      console.log('é€‰ä¸­çš„æ–‡ä»¶:', this.files);\n    },\n    submitForm(event) {\n      event.preventDefault();\n      if (!this.file) {\n        this.$message.warning(\"è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶\");\n        return;\n      }\n      this.uploading = true; // ğŸ‘ˆ å¼€å§‹ä¸Šä¼ \n      this.uploadProgress = 0;\n      let formData = new FormData();\n      formData.append('ifile', this.file);\n      formData.append(\"path\", this.pathString);\n      let config = {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n          \"satoken\": sessionStorage.getItem(\"satoken\")\n        },\n        onUploadProgress: progressEvent => {\n          if (progressEvent.total > 0) {\n            this.uploadProgress = Math.round(progressEvent.loaded / progressEvent.total * 100);\n          }\n        }\n      };\n      var url = \"http://localhost:8989/upload\";\n      this.$axios.post(url, formData, config) // ğŸ‘ˆ æ”¹ä¸º $axios\n      .then(res => {\n        let data = res.data;\n        if (data.code !== 10000) {\n          this.$message.error(data.message || \"ä¸Šä¼ å¤±è´¥\");\n        } else {\n          this.getFileAndFolder();\n          this.$message.success(\"ä¸Šä¼ æˆåŠŸ\");\n        }\n      }).catch(err => {\n        console.error(\"ä¸Šä¼ å‡ºé”™\", err);\n        this.$message.error(\"ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯\");\n      }).finally(() => {\n        this.uploading = false; // ğŸ‘ˆ æ— è®ºæˆåŠŸå¤±è´¥éƒ½å…³é—­\n      });\n    },\n\n    download(row) {\n      let that = this;\n      console.log(row);\n      let headers = {\n        'Content-Type': 'multipart/form-data',\n        \"satoken\": sessionStorage.getItem(\"satoken\")\n      };\n      var fileId = row.id;\n      var filename = row.fileName;\n      // let url=\"http://localhost:8989/download?fileId=\"+fileId\n      // window.open(url, \"_blank\")\n      this.axios({\n        url: \"http://localhost:8989/download\",\n        method: \"GET\",\n        headers: headers,\n        params: {\n          fileId: fileId\n        }\n      }).then(res => {\n        console.log(res);\n        that.$message({\n          message: \"è¯·æ±‚æˆåŠŸ\",\n          type: \"success\"\n        });\n        let blob = new Blob([res.data]);\n        let downloadElement = document.createElement(\"a\");\n        let href = window.URL.createObjectURL(blob); //åˆ›å»ºä¸‹è½½çš„é“¾æ¥\n        downloadElement.href = href;\n        downloadElement.download = filename; //ä¸‹è½½åæ–‡ä»¶å\n        document.body.appendChild(downloadElement);\n        downloadElement.click(); //ç‚¹å‡»ä¸‹è½½\n        document.body.removeChild(downloadElement); //ä¸‹è½½å®Œæˆç§»é™¤å…ƒç´ \n        window.URL.revokeObjectURL(href); //é‡Šæ”¾æ‰blobå¯¹è±¡\n      }).catch(function (error) {\n        if (error.response.status == 400) {\n          that.$message({\n            message: \"æ–‡ä»¶ä¸å­˜åœ¨\",\n            type: \"error\"\n          });\n        } else if (error.response.status == 500) {\n          that.$message({\n            message: \"æŠ±æ­‰ï¼Œæ–‡ä»¶å·²ä¸¢å¤±\",\n            type: \"error\"\n          });\n        }\n      });\n    }\n  },\n  get methods() {\n    return this._methods;\n  },\n  set methods(value) {\n    this._methods = value;\n  }\n};","map":{"version":3,"mappings":";AAwEA;EACAA;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MAEA;MACAC;MACAC;MAEAC;IACA;EACA;;EACAC;IACA;IACAC;MACA;MACA;QACA;MACA;MACA;QACA;QACAC;MACA;MACA;IACA;EACA;EAEAC;IACAC;MACA;MACAC,8CACAC,iCACAC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEA;IACAC;MACA;MACA;QACA;QACA;MACA;MACA;MACA;MACA;MACA;QACAC;QACAC;MACA;QACA;QACAC;QACA;UACA;QACA;MACA;IACA;IAEA;IACAC;MACA;MACAD;MACA;MACA;MACA;MACA;MACA;QACAF;QACAC;MACA;QACA;QACAC;QACA;UACA;QACA;MACA;IACA;IAEA;IACAE;MAEA;QACA;QACA;MACA;MACA;MACA;;MAEA;MACA;MACAF;MACA;MACA;QACAD;QACAD;QACAK;UACA;QACA;QACAC;MACA;QACAJ;QACAA;QACA;QACA;UAAAK;QAAA;QACA;QACA;UACAL;UACA;YACAA;YACAA;YACAM;YACAA;cACAP;cACAD;cACAK;gBACA;cACA;YACA;cACAH;cACA;cACAM;cACAA;YACA;YACA;UACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MAEA;IAEA;;IAEA;IACAC;MACA;QACAC;QACAC;MACA;QAAAC;MAAA;QACA;UACA;YACAL;YACAM;UACA;UACA;QACA;QACA;UACAb;UACAC;UACApB;YACAiC;YACAC;UACA;QACA;UACA;UACA;YACA;YACA;cACAR;cACAM;YACA;UACA;YACA;cACAN;cACAM;YACA;UACA;QACA;MACA;QACA;UACAN;UACAM;QACA;MACA;IACA;IAGA;IACAG;MACAd;MACA;QACAQ;QACAC;MACA;QAAAC;MAAA;QACA;UACA;YACAL;YACAM;UACA;UACA;QACA;QACA;UACA;YACAN;YACAM;UACA;UACA;QACA;QACA;UACAb;UACAC;UACApB;YACAiC;YACAG;UACA;QACA;UACA;UACA;YACA;YACA;cACAV;cACAM;YACA;UACA;YACA;cACAN;cACAM;YACA;UACA;QACA;MACA;QACA;UACAN;UACAM;QACA;MACA;IACA;IAEAK;MACA;QACAlB;QACAC;MACA;IACA;IAEA;IACAkB;MACA;MACA;QACAnB;QACAC;MACA;QACA;QACAC;QACA;UACA;QACA;MACA;IACA;IAEA;IACAkB;MACA;QACAV;QACAC;MACA;QAAAC;MAAA;QACA;UACA;YACAL;YACAM;UACA;UACA;QACA;QACA;UACAb;UACAC;UACApB;YACAwC;YACAC;UACA;QACA;UACA;UACA;YACA;YACA;cACAf;cACAM;YACA;UACA;YACA;cACAN;cACAM;YACA;UACA;QACA;MACA;QACA;UACAN;UACAM;QACA;MACA;IACA;IAEA;IACAU;MACA;QACA;UACAvB;UACAC;UACApB;YACA2C;UACA;QACA;UACA;UACA;YACA;YACA;cACAjB;cACAM;YACA;UACA;YACA;cACAN;cACAM;YACA;UACA;QACA;MACA;QACA;UACAN;UACAM;QACA;MACA;IACA;IAGAY;MACA;MACAvB;IACA;IAEAwB;MACAC;MACA;QACA;QACA;MACA;MAEA;MACA;MAEA;MACAC;MACAA;MAEA;QACAvB;UACA;UACA;QACA;QACAwB;UACA;YACA;UACA;QACA;MACA;MAEA;MACA;MAAA,CACAhC;QACA;QACA;UACA;QACA;UACA;UACA;QACA;MACA,GACAC;QACAI;QACA;MACA,GACA4B;QACA;MACA;IACA;;IAEAC;MACA;MACA7B;MACA;QACA;QACA;MACA;MACA;MACA;MACA;MACA;MACA;QACAD;QACAD;QACAK;QACA2B;UACAR;QACA;MACA;QACAtB;QACAM;UACAK;UACAN;QACA;QACA;QACA;QACA;QACA0B;QACAA;QACAC;QACAD;QACAC;QACAC;MACA;QACA;UACA3B;YACAK;YACAN;UACA;QACA,OACA;UACAC;YACAK;YACAN;UACA;QACA;MACA;IAEA;EACA;EAEA;IACA;EACA;EACA;IACA;EACA;AACA","names":["data","show","tableData","pathArr","imgUrl","dialogVisible","fileUrl","uploading","uploadProgress","files","computed","pathString","pstr","_methods","copy","navigator","then","catch","returnToLastDir","method","url","console","enterNextDir","shareFile","headers","responseType","type","that","handleEdit_","confirmButtonText","cancelButtonText","value","message","folderId","newFolderName","moveFile","newPath","updateFolderSize","getFileAndFolder","createDir","path","folderName","deleteFile_","fileId","getFile","submitForm","event","formData","onUploadProgress","finally","download","params","downloadElement","document","window"],"sourceRoot":"src/views/Mydisk","sources":["Mydisk.vue"],"sourcesContent":["<template>\r\n    <div class=\"mydisk\">\r\n        <el-dialog\r\n          title=\"åˆ†äº«è¯¦æƒ…\"\r\n          :visible.sync=\"dialogVisible\"\r\n          width=\"30%\">\r\n          <strong>æ‚¨çš„åˆ†äº«äºŒç»´ç ï¼š</strong>\r\n<!--          <image width='390' height='200' :src=\"imgUrl\"/>-->\r\n<!--          <image src=\"F://wallhaven/bg.jpg\"></image>-->\r\n          <img :src=\"imgUrl\" class=\"dialogImg\">\r\n\r\n          <strong><br>æ‚¨çš„æ–‡ä»¶ä¸‹è½½åœ°å€ï¼š</strong>\r\n          <textarea id=\"textarea\" cols=\"25\" rows=\"1\" v-model=\"fileUrl\"></textarea>\r\n          <span slot=\"footer\" class=\"dialog-footer\">\r\n            <el-button @click=\"copy\">å¤åˆ¶</el-button>\r\n            <el-button type=\"primary\" @click=\"dialogVisible = false\">ç¡® å®š</el-button>\r\n          </span>\r\n        </el-dialog>\r\n        <!-- æŒ‰é’®åŒºåŸŸ -->\r\n<!--        <el-image :src=\"imgUrl\"></el-image>-->\r\n        <div class=\"header\">\r\n            <!-- <el-button type=\"danger\" >ä¸Šä¼ æ–‡ä»¶</el-button> -->\r\n            <form style=\"height: 40px; display: flex; align-items: center;\">\r\n                <input type=\"file\" class=\"input1_\" @change=\"getFile($event)\" multiple>\r\n                <button class=\"btn1_\" @click=\"submitForm($event)\">æäº¤</button>\r\n\r\n              <!-- ğŸ‘‡ æ–°å¢ï¼šè¿›åº¦æ¡ -->\r\n              <el-progress\r\n                  v-if=\"uploading\"\r\n                  :percentage=\"uploadProgress\"\r\n                  style=\"width: 300px; margin-left: 10px;\"\r\n                  :stroke-width=\"10\"\r\n                  :show-text=\"true\">\r\n              </el-progress>\r\n            </form>\r\n\r\n            <el-button type=\"primary\" @click=\"createDir\" style=\"margin-left: 30px\">åˆ›å»ºæ–‡ä»¶å¤¹</el-button>\r\n<!--            <el-button type=\"info\" @click=\"deleteFile\">åˆ é™¤</el-button>-->\r\n<!--            <el-button type=\"primary\" @click=\"shareFiles\">åˆ†äº«</el-button>-->\r\n            <el-button type=\"primary\" @click=\"returnToLastDir()\">è¿”å›ä¸Šçº§</el-button>\r\n<!--            <el-button type=\"primary\"></el-button>-->\r\n        </div>\r\n<!--        å±•ç°é¢åŒ…å±‘-->\r\n        <div class=\"bread\">\r\n          å½“å‰è·¯å¾„ï¼š{{pathString}}\r\n        </div>\r\n      <!-- è¡¨æ ¼åŒºåŸŸå±•ç¤ºè§†å›¾æ•°æ® -->\r\n        <div class=\"wrapper\">\r\n            <el-table :data=\"tableData\" border ref=\"accountTable\" style=\"width:100%\">\r\n<!--                <el-table-column type=\"\" width=\"100\"> </el-table-column>-->\r\n                <el-table-column v-if=\"show\" prop=\"id\" label=\"id\" width=\"200\" style=\"padding: 0\"></el-table-column>\r\n              <el-table-column prop=\"fileImg\" label=\"\" width=\"50\"></el-table-column>\r\n                <el-table-column prop=\"fileName\" label=\"æ–‡ä»¶å\" width=\"200\"></el-table-column>\r\n                <el-table-column prop=\"fileSize\" label=\"å¤§å°(KB)\" width=\"200\"></el-table-column>\r\n                <el-table-column prop=\"uploadTime\" label=\"ä¸Šä¼ æ—¶é—´\" width=\"200\"> </el-table-column>\r\n                <el-table-column label=\"æ“ä½œ\" width=\"500\">\r\n                  <template slot-scope=\"scope\">\r\n                    <el-button size=\"mini\" v-if=\"scope.row.isfolder===1\" @click=\"enterNextDir(scope.row)\">è¿›å…¥</el-button>\r\n                    <el-button size=\"mini\" v-if=\"scope.row.isfolder===0\" @click=\"download(scope.row)\">ä¸‹è½½</el-button>\r\n                    <el-button size=\"mini\" @click=\"shareFile(scope.row)\">åˆ†äº«</el-button>\r\n                    <el-button size=\"mini\" @click=\"handleEdit_(scope.row)\">é‡å‘½å</el-button>\r\n                    <el-button size=\"mini\" @click=\"moveFile(scope.row)\">ç§»åŠ¨</el-button>\r\n                    <el-button size=\"mini\" type=\"danger\" @click=\"deleteFile_(scope.row, scope.$index)\">åˆ é™¤</el-button>\r\n                  </template>\r\n                </el-table-column>\r\n            </el-table>\r\n        </div>\r\n        <!-- åˆ†é¡µ -->\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    export default {\r\n      data() {\r\n        return {\r\n          show: false,\r\n          tableData: this.$global_msg.disk,\r\n          pathArr: [],\r\n          imgUrl: \"\",\r\n          dialogVisible: false,\r\n          fileUrl: '',\r\n\r\n          // ğŸ‘‡ æ–°å¢ï¼šä¸Šä¼ çŠ¶æ€å’Œè¿›åº¦\r\n          uploading: false,\r\n          uploadProgress: 0,\r\n\r\n          files: [], // ğŸ‘ˆ æ–°å¢ï¼šç”¨äºå­˜å‚¨é€‰ä¸­çš„å¤šä¸ªæ–‡ä»¶\r\n        };\r\n      },\r\n        computed:{\r\n          //ç»è¿‡æ‹¼æ¥çš„é¢åŒ…å±‘ç›®å½•\r\n          pathString:function (){\r\n            var pstr = \"/\";\r\n            if(this.pathArr.length===0){\r\n              return pstr;\r\n            }\r\n            for(var i = 0;i<this.pathArr.length;i++){\r\n              var tempStr = this.pathArr[i] + \"/\";\r\n              pstr += tempStr;\r\n            }\r\n            return pstr;\r\n          }\r\n        },\r\n\r\n      _methods: {\r\n        copy() {\r\n          const textarea = document.getElementById('textarea');\r\n          navigator.clipboard.writeText(textarea.value)\r\n              .then(() => this.$alert(\"å¤åˆ¶æˆåŠŸï¼\"))\r\n              .catch(err => console.error('å¤åˆ¶å¤±è´¥', err));\r\n        },\r\n        // copy(){\r\n        //   var content = document.getElementById('textarea').innerHTML;\r\n        //\r\n        //   navigator.clipboard.writeText(content)\r\n        //   .then(() => {\r\n        //     this.$alert(\"å¤åˆ¶æˆåŠŸï¼\")\r\n        //   })\r\n        //   .catch(err => {\r\n        //   console.log('Something went wrong', err);\r\n        //   })\r\n        // },\r\n\r\n        //è¿”å›ä¸Šçº§ç›®å½•\r\n        returnToLastDir(){\r\n          this.updateFolderSize()\r\n          if(this.pathArr.length===0){\r\n            this.$message.info(\"å·²ç»åˆ°è¾¾æ ¹ç›®å½•\")\r\n            return;\r\n          }\r\n          this.pathArr.pop();\r\n          //todo:æ›´æ–°å†…å®¹\r\n          var url = 'http://localhost:8989/getFilesAndFolders?path=' + this.pathString;\r\n          this.axios({\r\n            method:'GET',\r\n            url: url,\r\n          }).then((resp)=>{\r\n            let data = resp.data;\r\n            console.log(data)\r\n            if (data.success) {\r\n              this.tableData = data.data.fileList;\r\n            }\r\n          })\r\n        },\r\n\r\n        //ç‚¹å…¥æ–‡ä»¶å¤¹\r\n        enterNextDir(row){\r\n          this.updateFolderSize()\r\n          console.log(row);\r\n          var tempStr = row.fileName;\r\n          this.pathArr.push(tempStr);\r\n          //todoï¼šæ›´æ–°å†…å®¹\r\n          var url = 'http://localhost:8989/getFilesAndFolders?path=' + this.pathString;\r\n          this.axios({\r\n            method:'GET',\r\n            url: url,\r\n          }).then((resp)=>{\r\n            let data = resp.data;\r\n            console.log(data)\r\n            if (data.success) {\r\n              this.tableData = data.data.fileList;\r\n            }\r\n          })\r\n        },\r\n\r\n        //æ–‡ä»¶åˆ†äº«\r\n        shareFile(row){\r\n\r\n          if(row.isfolder===1){\r\n            this.$message.warning(\"æš‚æ—¶ä¸æ”¯æŒåˆ†äº«æ–‡ä»¶å¤¹å†…å®¹\")\r\n            return;\r\n          }\r\n          var that = this;\r\n          //è¯·æ±‚tokenï¼Œç”±äºå¼‚æ­¥çš„å…³ç³»ï¼Œåœ¨å¼¹çª—å¼¹å‡ºæ¥ä¹‹å‰è¦æ”¹å®Œæ•°æ®ï¼Œæ‰€æœ‰è¿™æ®µæ”¾å‰é¢ï¼Œæ”¶å›¾ç‰‡è‚¯å®šæ¯”æ”¶å­—ç¬¦ä¸²æ…¢\r\n\r\n          // this.$loading(\"loading\");//æ˜¾ç¤ºæ­£åœ¨åŠ è½½\r\n          //æ¥ä¸‹æ¥çš„é€»è¾‘ä¸ºï¼Œå‘èµ·è¯·æ±‚ï¼ŒæˆåŠŸåŠ è½½/åŠ è½½å¤±è´¥\r\n          console.log(sessionStorage.getItem(\"saToken\"));\r\n          var url = \"http://localhost:8989/fileShare/createQRCode1?fileId=\" + row.id;\r\n          this.$axios({\r\n            url:url,\r\n            method:\"GET\",\r\n            headers:{\r\n              'satoken':sessionStorage.getItem(\"saToken\")\r\n            },\r\n            responseType:\"blob\"\r\n          }).then(function (res){\r\n            console.log(\"è¯·æ±‚å‘èµ·æˆåŠŸ\");\r\n            console.log(res);\r\n            var typeArray = res.data;\r\n            var blob = new Blob([typeArray],{type:res.headers['Content-Type']});\r\n            var url = window.URL.createObjectURL(blob);\r\n            while(1){\r\n              console.log(\"è¿˜æœªè·å¾—url\");\r\n              if(url!=''){\r\n                console.log(\"è·å¾—urläº†\");\r\n                console.log(url);\r\n                that.imgUrl = url;\r\n                that.$axios({\r\n                  url:\"http://localhost:8989/getShareCode?fileId=\"+row.id,\r\n                  method:\"GET\",\r\n                  headers:{\r\n                    'satoken':sessionStorage.getItem(\"saToken\")\r\n                  },\r\n                }).then(res=>{\r\n                  console.log(res)\r\n                  var token=res.data.data[\"access_token\"]\r\n                  that.fileUrl=\"http://localhost:8989/publicDownload?access_token=\"+token\r\n                  that.dialogVisible=true\r\n                })\r\n                break;\r\n              }\r\n            }\r\n            // var imgHtmlString = \"<image src='\" + url + \"'>\";\r\n            //å¼¹çª—\r\n            // that.$alert('<strong>æ‚¨çš„åˆ†äº«äºŒç»´ç ï¼š</strong>' +\r\n            //     \"<image width='390' height='200' src='\" + url + \"'>\" +\r\n            //     '<strong>æ‚¨çš„æ–‡ä»¶ä¸‹è½½åœ°å€ï¼š</strong>', 'åˆ†äº«è¯¦æƒ…', {\r\n            //   dangerouslyUseHTMLString: true\r\n            // });\r\n\r\n          })\r\n          \r\n        },\r\n\r\n        // æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶é‡å‘½å\r\n        handleEdit_(row) {\r\n          this.$prompt('ä¿®æ”¹æ–‡ä»¶å', 'æç¤º', {\r\n            confirmButtonText: 'ç¡®å®š',\r\n            cancelButtonText: 'å–æ¶ˆ',\r\n          }).then(({ value }) => {\r\n            if(value == null){\r\n              this.$message({\r\n                type: 'info',\r\n                message: \"è¾“å…¥ä¸èƒ½ä¸ºç©º\"\r\n              });\r\n              return;\r\n            }\r\n            this.axios({\r\n              method:'PUT',\r\n              url:'http://localhost:8989/rename',\r\n              data:{\r\n                folderId: row.id,\r\n                newFolderName: value\r\n              },\r\n            }).then((resp) => {\r\n              let data=resp.data;\r\n              if(data.success) {\r\n                this.getFileAndFolder()\r\n                this.$message({\r\n                  type: 'success',\r\n                  message: data.message\r\n                });\r\n              } else {\r\n                this.$message({\r\n                  type: 'info',\r\n                  message: data.message\r\n                });\r\n              }\r\n            });\r\n          }).catch(() => {\r\n            this.$message({\r\n              type: 'info',\r\n              message: 'å–æ¶ˆè¾“å…¥'\r\n            });\r\n          });\r\n        },\r\n\r\n\r\n        //ç§»åŠ¨æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶\r\n        moveFile(row) {\r\n            console.log(row);\r\n            this.$prompt('è¾“å…¥è¦ç§»åŠ¨çš„è·¯å¾„ï¼Œæ ¼å¼: /**/**/', 'ç§»åŠ¨åˆ°', {\r\n              confirmButtonText: 'ç¡®å®š',\r\n              cancelButtonText: 'å–æ¶ˆ',\r\n            }).then(({ value }) => {\r\n              if(value == null){\r\n                this.$message({\r\n                  type: 'info',\r\n                  message: \"è¾“å…¥ä¸èƒ½ä¸ºç©º\"\r\n                });\r\n                return;\r\n              }\r\n              if(this.pathString == value){\r\n                this.$message({\r\n                  type: 'info',\r\n                  message: \"å·²åœ¨å½“å‰æ–‡ä»¶å¤¹\"\r\n                });\r\n                return;\r\n              }\r\n              this.axios({\r\n                method:'PUT',\r\n                url:'http://localhost:8989/move',\r\n                data:{\r\n                  folderId: row.id,\r\n                  newPath: value\r\n                },\r\n              }).then((resp) => {\r\n                let data=resp.data;\r\n                if(data.success) {\r\n                  this.getFileAndFolder()\r\n                  this.$message({\r\n                    type: 'success',\r\n                    message: data.message\r\n                  });\r\n                } else {\r\n                  this.$message({\r\n                    type: 'info',\r\n                    message: data.message\r\n                  });\r\n                }\r\n              });\r\n            }).catch(() => {\r\n              this.$message({\r\n                type: 'info',\r\n                message: 'å–æ¶ˆè¾“å…¥'\r\n              });\r\n            });\r\n        },\r\n\r\n        updateFolderSize() {\r\n          this.axios({\r\n            method:'GET',\r\n            url:'http://localhost:8989/getFolderSize?path='+this.pathString,\r\n          })\r\n        },\r\n\r\n        // è·å–è·¯å¾„ä¸‹æ–‡ä»¶å’Œæ–‡ä»¶å¤¹\r\n        getFileAndFolder() {\r\n          var url = 'http://localhost:8989/getFilesAndFolders?path=' + this.pathString;\r\n          this.axios({\r\n            method:'GET',\r\n            url: url,\r\n          }).then((resp)=>{\r\n            let data = resp.data;\r\n            console.log(data)\r\n            if (data.success) {\r\n              this.tableData = data.data.fileList;\r\n            }\r\n          })\r\n        },\r\n\r\n        // åˆ›å»ºæ–‡ä»¶å¤¹\r\n        createDir() {\r\n          this.$prompt('è¾“å…¥æ–‡ä»¶å¤¹ç›®å½•', 'æç¤º', {\r\n            confirmButtonText: 'ç¡®å®š',\r\n            cancelButtonText: 'å–æ¶ˆ',\r\n          }).then(({ value }) => {\r\n            if(value == null){\r\n              this.$message({\r\n                type: 'info',\r\n                message: \"è¾“å…¥ä¸èƒ½ä¸ºç©º\"\r\n              });\r\n              return;\r\n            }\r\n            this.axios({\r\n              method:'POST',\r\n              url:'http://localhost:8989/createFolder',\r\n              data:{\r\n                path: this.pathString,\r\n                folderName: value\r\n              }\r\n            }).then((resp) => {\r\n              let data=resp.data;\r\n              if(data.success) {\r\n                this.getFileAndFolder()\r\n                this.$message({\r\n                  type: 'success',\r\n                  message: data.message\r\n                });\r\n              } else {\r\n                this.$message({\r\n                  type: 'info',\r\n                  message: data.message\r\n                });\r\n              }\r\n            });\r\n          }).catch(() => {\r\n            this.$message({\r\n              type: 'info',\r\n              message: 'å–æ¶ˆè¾“å…¥'\r\n            });\r\n          });\r\n        },\r\n\r\n        // åˆ é™¤æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶\r\n        deleteFile_(row, index) {\r\n          if(confirm(\"æ˜¯å¦åˆ é™¤ï¼\")) {\r\n            this.axios({\r\n              method:'DELETE',\r\n              url:'http://localhost:8989/delete',\r\n              data:{\r\n                fileId: row.id\r\n              }\r\n            }).then((resp) => {\r\n              let data=resp.data;\r\n              if(data.success) {\r\n                this.tableData.splice(index,1)\r\n                this.$message({\r\n                  type: 'success',\r\n                  message: data.message\r\n                });\r\n              } else {\r\n                this.$message({\r\n                  type: 'info',\r\n                  message: data.message\r\n                });\r\n              }\r\n            });\r\n          }else {\r\n            this.$message({\r\n              type: 'info',\r\n              message: 'å–æ¶ˆåˆ é™¤'\r\n            });\r\n          }\r\n        },\r\n\r\n\r\n        getFile(event) {\r\n          this.files = Array.from(event.target.files); // âœ… è½¬ä¸ºæ•°ç»„ï¼Œä¾¿äºåç»­å¤„ç†\r\n          console.log('é€‰ä¸­çš„æ–‡ä»¶:', this.files);\r\n        },\r\n\r\n        submitForm(event) {\r\n          event.preventDefault();\r\n          if (!this.file) {\r\n            this.$message.warning(\"è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶\");\r\n            return;\r\n          }\r\n\r\n          this.uploading = true;        // ğŸ‘ˆ å¼€å§‹ä¸Šä¼ \r\n          this.uploadProgress = 0;\r\n\r\n          let formData = new FormData();\r\n          formData.append('ifile', this.file);\r\n          formData.append(\"path\", this.pathString);\r\n\r\n          let config = {\r\n            headers: {\r\n              'Content-Type': 'multipart/form-data',\r\n              \"satoken\": sessionStorage.getItem(\"satoken\")\r\n            },\r\n            onUploadProgress: (progressEvent) => {\r\n              if (progressEvent.total > 0) {\r\n                this.uploadProgress = Math.round((progressEvent.loaded / progressEvent.total) * 100);\r\n              }\r\n            }\r\n          };\r\n\r\n          var url = \"http://localhost:8989/upload\";\r\n          this.$axios.post(url, formData, config)  // ğŸ‘ˆ æ”¹ä¸º $axios\r\n              .then(res => {\r\n                let data = res.data;\r\n                if (data.code !== 10000) {\r\n                  this.$message.error(data.message || \"ä¸Šä¼ å¤±è´¥\");\r\n                } else {\r\n                  this.getFileAndFolder();\r\n                  this.$message.success(\"ä¸Šä¼ æˆåŠŸ\");\r\n                }\r\n              })\r\n              .catch(err => {\r\n                console.error(\"ä¸Šä¼ å‡ºé”™\", err);\r\n                this.$message.error(\"ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯\");\r\n              })\r\n              .finally(() => {\r\n                this.uploading = false;   // ğŸ‘ˆ æ— è®ºæˆåŠŸå¤±è´¥éƒ½å…³é—­\r\n              });\r\n        },\r\n\r\n        download(row) {\r\n          let that=this\r\n          console.log(row)\r\n          let headers={\r\n            'Content-Type': 'multipart/form-data',\r\n            \"satoken\": sessionStorage.getItem(\"satoken\")\r\n          }\r\n          var fileId=row.id\r\n          var filename=row.fileName\r\n          // let url=\"http://localhost:8989/download?fileId=\"+fileId\r\n          // window.open(url, \"_blank\")\r\n          this.axios({\r\n            url: \"http://localhost:8989/download\",\r\n            method: \"GET\",\r\n            headers: headers,\r\n            params: {\r\n              fileId: fileId\r\n            },\r\n          }).then(res=>{\r\n            console.log(res)\r\n            that.$message({\r\n              message: \"è¯·æ±‚æˆåŠŸ\",\r\n              type: \"success\"\r\n            })\r\n            let blob = new Blob([res.data]);\r\n            let downloadElement = document.createElement(\"a\");\r\n            let href = window.URL.createObjectURL(blob); //åˆ›å»ºä¸‹è½½çš„é“¾æ¥\r\n            downloadElement.href = href;\r\n            downloadElement.download = filename; //ä¸‹è½½åæ–‡ä»¶å\r\n            document.body.appendChild(downloadElement);\r\n            downloadElement.click(); //ç‚¹å‡»ä¸‹è½½\r\n            document.body.removeChild(downloadElement); //ä¸‹è½½å®Œæˆç§»é™¤å…ƒç´ \r\n            window.URL.revokeObjectURL(href); //é‡Šæ”¾æ‰blobå¯¹è±¡\r\n          }).catch(function(error){\r\n            if (error.response.status==400){\r\n              that.$message({\r\n                message: \"æ–‡ä»¶ä¸å­˜åœ¨\",\r\n                type: \"error\"\r\n              })\r\n            }\r\n            else if (error.response.status==500){\r\n              that.$message({\r\n                message: \"æŠ±æ­‰ï¼Œæ–‡ä»¶å·²ä¸¢å¤±\",\r\n                type: \"error\"\r\n              })\r\n            }\r\n          })\r\n\r\n        }\r\n      },\r\n      \r\n      get methods() {\r\n        return this._methods;\r\n      },\r\n      set methods(value) {\r\n        this._methods=value;\r\n      },\r\n    }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.mydisk{\r\n    margin-left: 0px;\r\n}\r\n.header {\r\n  display: flex;\r\n  align-items: center; // å‚ç›´å±…ä¸­\r\n  margin-top: 10px;\r\n  margin-left: 20px;\r\n  flex-wrap: wrap; // é˜²æ­¢å°å±æº¢å‡º\r\n}\r\n\r\n.bread{\r\n  display: flex;\r\n  margin-left: 20px;\r\n  margin-top: 20px;\r\n}\r\n\r\n.wrapper{\r\n    margin: 10px 20px;\r\n}\r\n\r\n.input1_ {\r\n    width: 150px;\r\n}\r\n.btn1_ {\r\n    background-color: #409EFF;\r\n    border: 0px;\r\n    height: 30px;\r\n    border-radius: 8px;\r\n    color: white;\r\n    width: 50px;\r\n}\r\n\r\n.dialogImg{\r\n  width: 80%;\r\n  //margin-left: 5%;\r\n  height: 60%;\r\n  margin-bottom: 5%;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}