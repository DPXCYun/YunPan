{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  data() {\n    return {\n      tableData: \"\",\n      fileList: '',\n      fileInfo: [],\n      selectedFiles: [],\n      // üëá Êñ∞Â¢û\n      shareLink: '' // Áî®‰∫éÁªëÂÆöËæìÂÖ•Ê°Ü\n    };\n  },\n\n  methods: {\n    handleRemove(file, fileList) {\n      console.log(file, fileList);\n    },\n    handlePreview(file) {\n      console.log(file);\n    },\n    handleExceed(files, fileList) {\n      this.$message.warning(`ÂΩìÂâçÈôêÂà∂ÈÄâÊã© 3 ‰∏™Êñá‰ª∂ÔºåÊú¨Ê¨°ÈÄâÊã©‰∫Ü ${files.length} ‰∏™Êñá‰ª∂ÔºåÂÖ±ÈÄâÊã©‰∫Ü ${files.length + fileList.length} ‰∏™Êñá‰ª∂`);\n    },\n    beforeRemove(file, fileList) {\n      return this.$confirm(`Á°ÆÂÆöÁßªÈô§ ${file.name}Ôºü`);\n    },\n    saveShare() {},\n    QRDecode() {\n      //Êâ´Á†ÅÊé•Êî∂\n      console.log(\"Êâ´Á†ÅÊé•Êî∂Ë¢´ÁÇπÂáª‰∫Ü\");\n      this.$refs.uploadInput.click();\n    },\n    uploadFile(e) {\n      const file = e.target.files[0];\n      console.log(\"ÊâßË°å‰∫ÜuploadFileÊñπÊ≥ï\");\n      //Ëé∑ÂèñÊñá‰ª∂\n      let formData = new FormData();\n      formData.append('file', file);\n      console.log(\"Ëé∑ÂèñÂà∞ÁöÑÊñá‰ª∂\" + formData);\n      //ÂèëËµ∑ËØ∑Ê±Ç\n      var url = \"http://localhost:8989/fileShare/readQRCode\";\n      let config = {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n          'satoken': sessionStorage.getItem(\"saToken\")\n        }\n      };\n      console.log(config);\n      this.$http.post(url, formData, config).then(res => {\n        console.log(res);\n        let data = res.data;\n        //Âä†Âà§Êñ≠ËØ≠Âè•\n        if (res.data.code !== 10000) {\n          //Ëã•Â§±Ë¥•ÔºåÁõ¥Êé•ÊèêÁ§∫ÈîôËØØÂéüÂõ†\n          this.$message.error(res.data.message);\n        } else {\n          //ÊàêÂäü\n          this.$message.success(\"ÊèêÂèñÊñá‰ª∂\" + res.data.message);\n          console.log(this.fileInfo); //ÂèØ‰ª•ÈÄöËøáthisËé∑ÂèñÂà∞data‰∏≠ÁöÑÂÜÖÂÆπ\n          console.log(this.fileInfo.length);\n          this.fileInfo.push(res.data.data.fileInfo);\n          console.log(this.fileInfo);\n          console.log(this.fileInfo.length);\n        }\n      });\n    },\n    // ÂΩìÁî®Êà∑ÂãæÈÄâË°®Ê†ºË°åÊó∂Ëß¶Âèë\n    handleSelectionChange(selection) {\n      this.selectedFiles = selection;\n    },\n    // ‰∏ãËΩΩÊñá‰ª∂ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂\n    downloadFile() {\n      if (this.selectedFiles.length === 0) {\n        this.$message.warning('ËØ∑ÂÖàÂãæÈÄâË¶Å‰∏ãËΩΩÁöÑÊñá‰ª∂');\n        return;\n      }\n      let headers = {\n        'Content-Type': 'multipart/form-data',\n        \"satoken\": sessionStorage.getItem(\"satoken\")\n      };\n\n      // ÈÅçÂéÜÈÄâ‰∏≠ÁöÑÊñá‰ª∂ÔºåÈÄê‰∏™Ëß¶ÂèëÊµèËßàÂô®‰∏ãËΩΩ\n      this.selectedFiles.forEach(file => {\n        // ÂÖ≥ÈîÆÔºöÁî® window.open Ëß¶ÂèëÂéüÁîü‰∏ãËΩΩ\n        window.open(file.downloadUrl, '_blank');\n        this.axios({\n          url: \"http://localhost:8989/download\",\n          method: \"GET\",\n          headers: headers,\n          params: {\n            fileId: file.fileId\n          }\n        }).then(res => {\n          console.log(res);\n          that.$message({\n            message: \"ËØ∑Ê±ÇÊàêÂäü\",\n            type: \"success\"\n          });\n        });\n      });\n    },\n    //Êñá‰ª∂‰∏ãËΩΩ\n    // downloadFile(){\n    //   console.log(\"‰∏ãËΩΩÊñá‰ª∂ÊåâÈíÆÁÇπÂáª\");\n    //   var that = this;\n    //   for (var i=0;i<this.fileInfo.length;i++){\n    //     this.$axios.get(that.fileInfo[i].downloadUrl)\n    //   }\n    // }\n\n    // üëá Êñ∞Â¢ûÔºö‰ªéÈìæÊé•Âä†ËΩΩÊñá‰ª∂\n    loadFromShareLink() {\n      if (!this.shareLink.trim()) {\n        this.$message.warning('ËØ∑ËæìÂÖ•ÂàÜ‰∫´ÈìæÊé•');\n        return;\n      }\n\n      // ‰ªé URL ‰∏≠ÊèêÂèñ access_token\n      let token = '';\n      try {\n        const url = new URL(this.shareLink);\n        token = url.searchParams.get('access_token');\n      } catch (e) {\n        this.$message.error('ÈìæÊé•Ê†ºÂºèÊó†ÊïàÔºåËØ∑ËæìÂÖ•ÂÆåÊï¥ÁöÑÂàÜ‰∫´ÈìæÊé•');\n        return;\n      }\n      if (!token) {\n        this.$message.error('ÈìæÊé•‰∏≠Êú™ÊâæÂà∞ access_tokenÔºåËØ∑Ê£ÄÊü•ÈìæÊé•ÊòØÂê¶Ê≠£Á°Æ');\n        return;\n      }\n\n      // Ë∞ÉÁî®ÂêéÁ´ØÊé•Âè£Ëé∑ÂèñÊñá‰ª∂‰ø°ÊÅØÔºàÈúÄÂêéÁ´ØÊîØÊåÅÔºâ\n      const url = `http://localhost:8989/fileShare/getSharedFileInfo?access_token=${token}`;\n      const config = {\n        headers: {\n          'satoken': sessionStorage.getItem(\"saToken\")\n        }\n      };\n      this.$http.get(url, config).then(res => {\n        if (res.data.code !== 10000) {\n          this.$message.error(res.data.message || 'Êó†Ê≥ïÂä†ËΩΩÂàÜ‰∫´ÂÜÖÂÆπ');\n        } else {\n          // ÂÅáËÆæËøîÂõûÁªìÊûÑ‰∏∫ res.data.data.fileInfoÔºà‰∏éÊâ´Á†ÅÊé•Âè£‰∏ÄËá¥Ôºâ\n          const fileInfo = res.data.data.fileInfo;\n          // ÊûÑÈÄ† downloadUrlÔºà‰∏éÊâ´Á†ÅËøîÂõûÁöÑ‰∏ÄËá¥Ôºâ\n          fileInfo.downloadUrl = `http://localhost:8989/publicDownload?access_token=${token}`;\n          // Ê∑ªÂä†Âà∞Ë°®Ê†º\n          this.fileInfo.push(fileInfo);\n          this.$message.success(`ÊàêÂäüÂä†ËΩΩÊñá‰ª∂Ôºö${fileInfo.fileName}`);\n        }\n      }).catch(err => {\n        console.error('Âä†ËΩΩÂ§±Ë¥•', err);\n        this.$message.error('ÁΩëÁªúÈîôËØØÊàñÈìæÊé•Â∑≤Â§±Êïà');\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";AAiEA;EACAA;IACA;MACAC;MACAC;MACAC;MACAC;MACA;MACAC;IACA;EACA;;EACAC;IACAC;MACAC;IACA;IACAC;MACAD;IACA;IACAE;MACA;IACA;IACAC;MACA;IACA;IACAC,aAEA;IACAC;MAAA;MACAL;MACA;IACA;IACAM;MACA;MACAN;MACA;MACA;MACAO;MACAP;MACA;MACA;MACA;QACAQ;UACA;UACA;QACA;MACA;MACAR;MACA;QACAA;QACA;QACA;QACA;UAAA;UACA;QACA;UAAA;UACA;UACAA;UACAA;UACA;UACAA;UACAA;QACA;MACA;IACA;IACA;IACAS;MACA;IACA;IAEA;IACAC;MACA;QACA;QACA;MACA;MACA;QACA;QACA;MACA;;MAEA;MACA;QACA;QACAC;QACA;UACAC;UACAC;UACAL;UACAM;YACAC;UACA;QACA;UACAf;UACAgB;YACAC;YACAC;UACA;QACA;MACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEA;IACAC;MACA;QACA;QACA;MACA;;MAEA;MACA;MACA;QACA;QACAC;MACA;QACA;QACA;MACA;MAEA;QACA;QACA;MACA;;MAEA;MACA;MACA;QACAZ;UACA;QACA;MACA;MAEA;QACA;UACA;QACA;UACA;UACA;UACA;UACAb;UACA;UACA;UACA;QACA;MACA;QACAK;QACA;MACA;IACA;EACA;AAGA","names":["data","tableData","fileList","fileInfo","selectedFiles","shareLink","methods","handleRemove","console","handlePreview","handleExceed","beforeRemove","saveShare","QRDecode","uploadFile","formData","headers","handleSelectionChange","downloadFile","window","url","method","params","fileId","that","message","type","loadFromShareLink","token"],"sourceRoot":"src/views/Receiveshare","sources":["Receiveshare.vue"],"sourcesContent":["<template>\r\n    <div>\r\n      <div class=\"header\">\r\n        <span class=\"title\">Êî∂Âà∞ÂàÜ‰∫´</span>\r\n      </div>\r\n      <div class=\"middle\">\r\n        <el-button class=\"receivebtn\" type=\"primary\" icon=\"el-icon-star-off\"\r\n                   @click=\"QRDecode()\">\r\n          Êâ´Á†ÅÊé•Êî∂\r\n        </el-button>\r\n        <el-button class=\"receivebtn\" type=\"primary\" icon=\"el-icon-star-off\"\r\n                   @click=\"downloadFile()\">\r\n          ‰∏ãËΩΩÊñá‰ª∂\r\n        </el-button>\r\n\r\n        <!-- üëá Êñ∞Â¢ûÔºöËæìÂÖ•ÈìæÊé•Êé•Êî∂ -->\r\n        <el-input\r\n            v-model=\"shareLink\"\r\n            placeholder=\"ËØ∑ËæìÂÖ•ÂàÜ‰∫´ÈìæÊé•\"\r\n            style=\"width: 300px; margin-left: 10px;\"\r\n            size=\"small\"\r\n        ></el-input>\r\n        <el-button\r\n            type=\"success\"\r\n            icon=\"el-icon-link\"\r\n            size=\"small\"\r\n            style=\"margin-left: 5px;\"\r\n            @click=\"loadFromShareLink()\"\r\n        >\r\n          Âä†ËΩΩÈìæÊé•\r\n        </el-button>\r\n        <input\r\n            id=\"file-selector\"\r\n            ref=\"uploadInput\"\r\n            type=\"file\"\r\n            @change=\"uploadFile\"\r\n            style=\"display: none\"/>\r\n      </div>\r\n      <div class=\"line\"></div>\r\n      <div class=\"body\">\r\n        <el-table\r\n          :data=\"fileInfo\"\r\n          height=\"550\"\r\n          stripe\r\n          border\r\n          style=\"width: 100%\"\r\n          ref=\"accountTable\"\r\n          @selection-change=\"handleSelectionChange\"\r\n        >\r\n          <el-table-column type=\"selection\" width=\"150\" align=\"center\"> </el-table-column>\r\n          <el-table-column prop=\"fileName\" label=\"ÂàÜ‰∫´Êñá‰ª∂Âêç\" width=\"300\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column prop=\"fileType\" label=\"Êñá‰ª∂Á±ªÂûã\" width=\"150\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column prop=\"fileSize\" label=\"Êñá‰ª∂Â§ßÂ∞è\" width=\"150\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column prop=\"ownerName\" label=\"ÂàÜ‰∫´‰∫∫\" width=\"150\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column prop=\"downloadTimes\" label=\"‰∏ãËΩΩÊ¨°Êï∞\" align=\"center\"> </el-table-column>\r\n        </el-table>\r\n      </div>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  export default {\r\n    data() {\r\n      return {\r\n        tableData: \"\",\r\n        fileList: '',\r\n        fileInfo: [],\r\n        selectedFiles: [],\r\n        // üëá Êñ∞Â¢û\r\n        shareLink: '' // Áî®‰∫éÁªëÂÆöËæìÂÖ•Ê°Ü\r\n      };\r\n    },\r\n    methods: {\r\n      handleRemove(file, fileList) {\r\n        console.log(file, fileList);\r\n      },\r\n      handlePreview(file) {\r\n        console.log(file);\r\n      },\r\n      handleExceed(files, fileList) {\r\n        this.$message.warning(`ÂΩìÂâçÈôêÂà∂ÈÄâÊã© 3 ‰∏™Êñá‰ª∂ÔºåÊú¨Ê¨°ÈÄâÊã©‰∫Ü ${files.length} ‰∏™Êñá‰ª∂ÔºåÂÖ±ÈÄâÊã©‰∫Ü ${files.length + fileList.length} ‰∏™Êñá‰ª∂`);\r\n      },\r\n      beforeRemove(file, fileList) {\r\n        return this.$confirm(`Á°ÆÂÆöÁßªÈô§ ${ file.name }Ôºü`);\r\n      },\r\n      saveShare() {\r\n\r\n      },\r\n      QRDecode(){//Êâ´Á†ÅÊé•Êî∂\r\n        console.log(\"Êâ´Á†ÅÊé•Êî∂Ë¢´ÁÇπÂáª‰∫Ü\");\r\n        this.$refs.uploadInput.click();\r\n      },\r\n      uploadFile(e){\r\n        const file = e.target.files[0];\r\n        console.log(\"ÊâßË°å‰∫ÜuploadFileÊñπÊ≥ï\");\r\n        //Ëé∑ÂèñÊñá‰ª∂\r\n        let formData = new FormData();\r\n        formData.append('file', file);\r\n        console.log(\"Ëé∑ÂèñÂà∞ÁöÑÊñá‰ª∂\" + formData);\r\n        //ÂèëËµ∑ËØ∑Ê±Ç\r\n        var url = \"http://localhost:8989/fileShare/readQRCode\";\r\n        let config = {\r\n          headers:{\r\n            'Content-Type':'multipart/form-data',\r\n            'satoken':sessionStorage.getItem(\"saToken\")\r\n          }\r\n        }\r\n        console.log(config);\r\n        this.$http.post(url,formData,config).then(res=>{\r\n          console.log(res);\r\n          let data = res.data;\r\n          //Âä†Âà§Êñ≠ËØ≠Âè•\r\n          if(res.data.code!==10000){//Ëã•Â§±Ë¥•ÔºåÁõ¥Êé•ÊèêÁ§∫ÈîôËØØÂéüÂõ†\r\n            this.$message.error(res.data.message);\r\n          }else{//ÊàêÂäü\r\n            this.$message.success(\"ÊèêÂèñÊñá‰ª∂\" + res.data.message);\r\n            console.log(this.fileInfo);//ÂèØ‰ª•ÈÄöËøáthisËé∑ÂèñÂà∞data‰∏≠ÁöÑÂÜÖÂÆπ\r\n            console.log(this.fileInfo.length);\r\n            this.fileInfo.push(res.data.data.fileInfo);\r\n            console.log(this.fileInfo);\r\n            console.log(this.fileInfo.length);\r\n          }\r\n        })\r\n      },\r\n      // ÂΩìÁî®Êà∑ÂãæÈÄâË°®Ê†ºË°åÊó∂Ëß¶Âèë\r\n      handleSelectionChange(selection) {\r\n        this.selectedFiles = selection;\r\n      },\r\n\r\n      // ‰∏ãËΩΩÊñá‰ª∂ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂\r\n      downloadFile() {\r\n        if (this.selectedFiles.length === 0) {\r\n          this.$message.warning('ËØ∑ÂÖàÂãæÈÄâË¶Å‰∏ãËΩΩÁöÑÊñá‰ª∂');\r\n          return;\r\n        }\r\n        let headers={\r\n          'Content-Type': 'multipart/form-data',\r\n          \"satoken\": sessionStorage.getItem(\"satoken\")\r\n        }\r\n\r\n        // ÈÅçÂéÜÈÄâ‰∏≠ÁöÑÊñá‰ª∂ÔºåÈÄê‰∏™Ëß¶ÂèëÊµèËßàÂô®‰∏ãËΩΩ\r\n        this.selectedFiles.forEach(file => {\r\n          // ÂÖ≥ÈîÆÔºöÁî® window.open Ëß¶ÂèëÂéüÁîü‰∏ãËΩΩ\r\n          window.open(file.downloadUrl, '_blank');\r\n          this.axios({\r\n            url: \"http://localhost:8989/download\",\r\n            method: \"GET\",\r\n            headers: headers,\r\n            params: {\r\n              fileId: file.fileId\r\n            },\r\n          }).then(res => {\r\n            console.log(res)\r\n            that.$message({\r\n              message: \"ËØ∑Ê±ÇÊàêÂäü\",\r\n              type: \"success\"\r\n            })\r\n          });\r\n        });\r\n      },\r\n      //Êñá‰ª∂‰∏ãËΩΩ\r\n      // downloadFile(){\r\n      //   console.log(\"‰∏ãËΩΩÊñá‰ª∂ÊåâÈíÆÁÇπÂáª\");\r\n      //   var that = this;\r\n      //   for (var i=0;i<this.fileInfo.length;i++){\r\n      //     this.$axios.get(that.fileInfo[i].downloadUrl)\r\n      //   }\r\n      // }\r\n\r\n      // üëá Êñ∞Â¢ûÔºö‰ªéÈìæÊé•Âä†ËΩΩÊñá‰ª∂\r\n      loadFromShareLink() {\r\n        if (!this.shareLink.trim()) {\r\n          this.$message.warning('ËØ∑ËæìÂÖ•ÂàÜ‰∫´ÈìæÊé•');\r\n          return;\r\n        }\r\n\r\n        // ‰ªé URL ‰∏≠ÊèêÂèñ access_token\r\n        let token = '';\r\n        try {\r\n          const url = new URL(this.shareLink);\r\n          token = url.searchParams.get('access_token');\r\n        } catch (e) {\r\n          this.$message.error('ÈìæÊé•Ê†ºÂºèÊó†ÊïàÔºåËØ∑ËæìÂÖ•ÂÆåÊï¥ÁöÑÂàÜ‰∫´ÈìæÊé•');\r\n          return;\r\n        }\r\n\r\n        if (!token) {\r\n          this.$message.error('ÈìæÊé•‰∏≠Êú™ÊâæÂà∞ access_tokenÔºåËØ∑Ê£ÄÊü•ÈìæÊé•ÊòØÂê¶Ê≠£Á°Æ');\r\n          return;\r\n        }\r\n\r\n        // Ë∞ÉÁî®ÂêéÁ´ØÊé•Âè£Ëé∑ÂèñÊñá‰ª∂‰ø°ÊÅØÔºàÈúÄÂêéÁ´ØÊîØÊåÅÔºâ\r\n        const url = `http://localhost:8989/fileShare/getSharedFileInfo?access_token=${token}`;\r\n        const config = {\r\n          headers: {\r\n            'satoken': sessionStorage.getItem(\"saToken\")\r\n          }\r\n        };\r\n\r\n        this.$http.get(url, config).then(res => {\r\n          if (res.data.code !== 10000) {\r\n            this.$message.error(res.data.message || 'Êó†Ê≥ïÂä†ËΩΩÂàÜ‰∫´ÂÜÖÂÆπ');\r\n          } else {\r\n            // ÂÅáËÆæËøîÂõûÁªìÊûÑ‰∏∫ res.data.data.fileInfoÔºà‰∏éÊâ´Á†ÅÊé•Âè£‰∏ÄËá¥Ôºâ\r\n            const fileInfo = res.data.data.fileInfo;\r\n            // ÊûÑÈÄ† downloadUrlÔºà‰∏éÊâ´Á†ÅËøîÂõûÁöÑ‰∏ÄËá¥Ôºâ\r\n            fileInfo.downloadUrl = `http://localhost:8989/publicDownload?access_token=${token}`;\r\n            // Ê∑ªÂä†Âà∞Ë°®Ê†º\r\n            this.fileInfo.push(fileInfo);\r\n            this.$message.success(`ÊàêÂäüÂä†ËΩΩÊñá‰ª∂Ôºö${fileInfo.fileName}`);\r\n          }\r\n        }).catch(err => {\r\n          console.error('Âä†ËΩΩÂ§±Ë¥•', err);\r\n          this.$message.error('ÁΩëÁªúÈîôËØØÊàñÈìæÊé•Â∑≤Â§±Êïà');\r\n        });\r\n      }\r\n    },\r\n\r\n\r\n  };\r\n  </script>\r\n  \r\n  <style lang=\"less\" scoped>\r\n  .header {\r\n    background-color: #dcdfe6;\r\n    height: 60px;\r\n    line-height: 60px;\r\n    display: flex;\r\n  }\r\n  .title {\r\n    color: #409eff;\r\n    float: left;\r\n    font-size: 30px;\r\n    margin-left: 20px;\r\n  }\r\n  .middle {\r\n    height: 50px;\r\n    line-height: 50px;\r\n    display: flex;\r\n  }\r\n  .receivebtn {\r\n    display: flex;\r\n    margin-left: 10px;\r\n    height: 80%;\r\n    margin-top: 5px;\r\n  }\r\n  .line {\r\n    height: 0;\r\n    width: 100%;\r\n    border: 1px solid #dcdfe6;\r\n  }\r\n  .body {\r\n    margin: 20px 10px;\r\n  }\r\n  </style>"]},"metadata":{},"sourceType":"module"}