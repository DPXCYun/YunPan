{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  data() {\n    // 自定义校验规则：两次密码一致\n    const validateConfirmPassword = (rule, value, callback) => {\n      if (value !== this.form.newPassword) {\n        callback(new Error('两次输入的密码不一致'));\n      } else {\n        callback();\n      }\n    };\n    return {\n      form: {\n        email: '',\n        code: '',\n        newPassword: '',\n        confirmPassword: ''\n      },\n      rules: {\n        email: [{\n          required: true,\n          message: '请输入邮箱',\n          trigger: 'blur'\n        }, {\n          type: 'email',\n          message: '请输入正确的邮箱格式',\n          trigger: 'blur'\n        }],\n        code: [{\n          required: true,\n          message: '请输入验证码',\n          trigger: 'blur'\n        }, {\n          len: 6,\n          message: '验证码为6位数字',\n          trigger: 'blur'\n        }],\n        newPassword: [{\n          required: true,\n          message: '请输入新密码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          max: 20,\n          message: '密码长度为6-20位',\n          trigger: 'blur'\n        }],\n        confirmPassword: [{\n          required: true,\n          message: '请确认新密码',\n          trigger: 'blur'\n        }, {\n          validator: validateConfirmPassword,\n          trigger: 'blur'\n        }]\n      },\n      canSendCode: false,\n      isCounting: false,\n      countdown: 60,\n      submitting: false\n    };\n  },\n  watch: {\n    'form.email'(val) {\n      this.canSendCode = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(val);\n    }\n  },\n  methods: {\n    // 发送验证码\n    sendCode() {\n      if (!this.canSendCode) {\n        this.$message.warning('请输入有效的邮箱');\n        return;\n      }\n      this.isCounting = true;\n      this.countdown = 60;\n\n      // 调用后端接口发送验证码\n      this.axios({\n        method: 'POST',\n        url: 'http://localhost:8989/forgetPassword',\n        data: {\n          email: this.form.email\n        },\n        timeout\n      }).then(res => {\n        if (res.data.success) {\n          this.$message.success('验证码已发送，请查收邮箱！');\n        } else {\n          this.$message.error(res.data.message || '发送失败');\n          this.isCounting = false; // 发送失败立即可重试\n        }\n      }).catch(err => {\n        this.$message.error('网络错误，请稍后重试');\n        console.error(err);\n        this.isCounting = false;\n      });\n\n      // 倒计时\n      const timer = setInterval(() => {\n        if (this.countdown > 0) {\n          this.countdown--;\n        } else {\n          clearInterval(timer);\n          this.isCounting = false;\n        }\n      }, 1000);\n    },\n    // 重置密码\n    resetPassword() {\n      this.$refs.formRef.validate(valid => {\n        if (!valid) return;\n        this.submitting = true;\n        this.axios({\n          method: 'POST',\n          url: 'http://localhost:8989/resetPassword',\n          data: {\n            email: this.form.email,\n            code: this.form.code,\n            newPassword: this.form.newPassword\n          }\n        }).then(res => {\n          if (res.data.success) {\n            this.$message.success('密码重置成功！正在跳转登录页...');\n            setTimeout(() => {\n              this.$router.push('/');\n            }, 1500);\n          } else {\n            this.$message.error(res.data.message || '重置失败');\n          }\n        }).catch(err => {\n          this.$message.error('网络错误，请稍后重试');\n          console.error(err);\n        }).finally(() => {\n          this.submitting = false;\n        });\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";AAmEA;EACAA;IACA;IACA;MACA;QACAC;MACA;QACAA;MACA;IACA;IAEA;MACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;QACAJ,QACA;UAAAK;UAAAC;UAAAC;QAAA,GACA;UAAAC;UAAAF;UAAAC;QAAA,EACA;QACAN,OACA;UAAAI;UAAAC;UAAAC;QAAA,GACA;UAAAE;UAAAH;UAAAC;QAAA,EACA;QACAL,cACA;UAAAG;UAAAC;UAAAC;QAAA,GACA;UAAAG;UAAAC;UAAAL;UAAAC;QAAA,EACA;QACAJ,kBACA;UAAAE;UAAAC;UAAAC;QAAA,GACA;UAAAK;UAAAL;QAAA;MAEA;MACAM;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;MACA;IACA;EACA;EACAC;IACA;IACAC;MACA;QACA;QACA;MACA;MAEA;MACA;;MAEA;MACA;QACAC;QACAC;QACAxB;UACAG;QACA;QACAsB;MACA;QACA;UACA;QACA;UACA;UACA;QACA;MACA;QACA;QACAC;QACA;MACA;;MAEA;MACA;QACA;UACA;QACA;UACAC;UACA;QACA;MACA;IACA;IAEA;IACAC;MACA;QACA;QAEA;QACA;UACAL;UACAC;UACAxB;YACAG;YACAC;YACAC;UACA;QACA;UACA;YACA;YACAwB;cACA;YACA;UACA;YACA;UACA;QACA;UACA;UACAH;QACA;UACA;QACA;MACA;IACA;EACA;AACA","names":["data","callback","form","email","code","newPassword","confirmPassword","rules","required","message","trigger","type","len","min","max","validator","canSendCode","isCounting","countdown","submitting","watch","methods","sendCode","method","url","timeout","console","clearInterval","resetPassword","setTimeout"],"sourceRoot":"src/views/ForgetPassword","sources":["ForgetPassword.vue"],"sourcesContent":["<!-- src/views/ForgetPassword.vue -->\r\n<template>\r\n  <div class=\"forget-container\">\r\n    <h2>找回密码</h2>\r\n    <el-form\r\n        ref=\"formRef\"\r\n        :model=\"form\"\r\n        :rules=\"rules\"\r\n        label-width=\"80px\"\r\n        style=\"max-width: 400px; margin: 20px auto;\"\r\n    >\r\n      <!-- 邮箱输入 -->\r\n      <el-form-item label=\"邮箱\" prop=\"email\">\r\n        <el-input v-model=\"form.email\" placeholder=\"请输入注册邮箱\"></el-input>\r\n      </el-form-item>\r\n\r\n      <!-- 获取验证码按钮 -->\r\n      <el-form-item label=\"验证码\" prop=\"code\">\r\n        <div style=\"display: flex; gap: 10px;\">\r\n          <el-input v-model=\"form.code\" placeholder=\"请输入验证码\" style=\"flex: 1;\"></el-input>\r\n          <el-button\r\n              type=\"primary\"\r\n              :disabled=\"!canSendCode || isCounting\"\r\n              @click=\"sendCode\"\r\n          >\r\n            {{ isCounting ? `${countdown}秒后重发` : '获取验证码' }}\r\n          </el-button>\r\n        </div>\r\n      </el-form-item>\r\n\r\n      <!-- 新密码 -->\r\n      <el-form-item label=\"新密码\" prop=\"newPassword\">\r\n        <el-input\r\n            v-model=\"form.newPassword\"\r\n            type=\"password\"\r\n            placeholder=\"请输入新密码（6-20位）\"\r\n            show-password\r\n        ></el-input>\r\n      </el-form-item>\r\n\r\n      <!-- 确认密码 -->\r\n      <el-form-item label=\"确认密码\" prop=\"confirmPassword\">\r\n        <el-input\r\n            v-model=\"form.confirmPassword\"\r\n            type=\"password\"\r\n            placeholder=\"请再次输入新密码\"\r\n            show-password\r\n        ></el-input>\r\n      </el-form-item>\r\n\r\n      <!-- 提交按钮 -->\r\n      <el-form-item>\r\n        <el-button\r\n            type=\"primary\"\r\n            @click=\"resetPassword\"\r\n            :loading=\"submitting\"\r\n            style=\"width: 100%;\"\r\n        >\r\n          重置密码\r\n        </el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n    <el-button @click=\"$router.back()\">返回登录</el-button>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    // 自定义校验规则：两次密码一致\r\n    const validateConfirmPassword = (rule, value, callback) => {\r\n      if (value !== this.form.newPassword) {\r\n        callback(new Error('两次输入的密码不一致'));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n\r\n    return {\r\n      form: {\r\n        email: '',\r\n        code: '',\r\n        newPassword: '',\r\n        confirmPassword: ''\r\n      },\r\n      rules: {\r\n        email: [\r\n          { required: true, message: '请输入邮箱', trigger: 'blur' },\r\n          { type: 'email', message: '请输入正确的邮箱格式', trigger: 'blur' }\r\n        ],\r\n        code: [\r\n          { required: true, message: '请输入验证码', trigger: 'blur' },\r\n          { len: 6, message: '验证码为6位数字', trigger: 'blur' }\r\n        ],\r\n        newPassword: [\r\n          { required: true, message: '请输入新密码', trigger: 'blur' },\r\n          { min: 6, max: 20, message: '密码长度为6-20位', trigger: 'blur' }\r\n        ],\r\n        confirmPassword: [\r\n          { required: true, message: '请确认新密码', trigger: 'blur' },\r\n          { validator: validateConfirmPassword, trigger: 'blur' }\r\n        ]\r\n      },\r\n      canSendCode: false,\r\n      isCounting: false,\r\n      countdown: 60,\r\n      submitting: false\r\n    };\r\n  },\r\n  watch: {\r\n    'form.email'(val) {\r\n      this.canSendCode = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(val);\r\n    }\r\n  },\r\n  methods: {\r\n    // 发送验证码\r\n    sendCode() {\r\n      if (!this.canSendCode) {\r\n        this.$message.warning('请输入有效的邮箱');\r\n        return;\r\n      }\r\n\r\n      this.isCounting = true;\r\n      this.countdown = 60;\r\n\r\n      // 调用后端接口发送验证码\r\n      this.axios({\r\n        method:'POST',\r\n        url:'http://localhost:8989/forgetPassword',\r\n        data:{\r\n          email:this.form.email\r\n        },\r\n        timeout\r\n      }).then(res => {\r\n        if (res.data.success) {\r\n          this.$message.success('验证码已发送，请查收邮箱！');\r\n        } else {\r\n          this.$message.error(res.data.message || '发送失败');\r\n          this.isCounting = false; // 发送失败立即可重试\r\n        }\r\n      }).catch(err => {\r\n        this.$message.error('网络错误，请稍后重试');\r\n        console.error(err);\r\n        this.isCounting = false;\r\n      });\r\n\r\n      // 倒计时\r\n      const timer = setInterval(() => {\r\n        if (this.countdown > 0) {\r\n          this.countdown--;\r\n        } else {\r\n          clearInterval(timer);\r\n          this.isCounting = false;\r\n        }\r\n      }, 1000);\r\n    },\r\n\r\n    // 重置密码\r\n    resetPassword() {\r\n      this.$refs.formRef.validate(valid => {\r\n        if (!valid) return;\r\n\r\n        this.submitting = true;\r\n        this.axios({\r\n            method:'POST',\r\n            url:'http://localhost:8989/resetPassword',\r\n            data:{\r\n              email: this.form.email,\r\n              code: this.form.code,\r\n              newPassword: this.form.newPassword\r\n            }\r\n        }).then(res => {\r\n          if (res.data.success) {\r\n            this.$message.success('密码重置成功！正在跳转登录页...');\r\n            setTimeout(() => {\r\n              this.$router.push('/');\r\n            }, 1500);\r\n          } else {\r\n            this.$message.error(res.data.message || '重置失败');\r\n          }\r\n        }).catch(err => {\r\n          this.$message.error('网络错误，请稍后重试');\r\n          console.error(err);\r\n        }).finally(() => {\r\n          this.submitting = false;\r\n        });\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.forget-container {\r\n  width: 100vw;\r\n  height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background: #f5f5f5;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}