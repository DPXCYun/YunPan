{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  data() {\n    return {\n      tableData: \"\",\n      fileList: '',\n      fileInfo: [],\n      selectedFiles: [],\n      // ğŸ‘‡ æ–°å¢\n      shareLink: '' // ç”¨äºç»‘å®šè¾“å…¥æ¡†\n    };\n  },\n\n  methods: {\n    handleRemove(file, fileList) {\n      console.log(file, fileList);\n    },\n    handlePreview(file) {\n      console.log(file);\n    },\n    handleExceed(files, fileList) {\n      this.$message.warning(`å½“å‰é™åˆ¶é€‰æ‹© 3 ä¸ªæ–‡ä»¶ï¼Œæœ¬æ¬¡é€‰æ‹©äº† ${files.length} ä¸ªæ–‡ä»¶ï¼Œå…±é€‰æ‹©äº† ${files.length + fileList.length} ä¸ªæ–‡ä»¶`);\n    },\n    beforeRemove(file, fileList) {\n      return this.$confirm(`ç¡®å®šç§»é™¤ ${file.name}ï¼Ÿ`);\n    },\n    saveShare() {},\n    QRDecode() {\n      //æ‰«ç æ¥æ”¶\n      console.log(\"æ‰«ç æ¥æ”¶è¢«ç‚¹å‡»äº†\");\n      this.$refs.uploadInput.click();\n    },\n    uploadFile(e) {\n      const file = e.target.files[0];\n      console.log(\"æ‰§è¡Œäº†uploadFileæ–¹æ³•\");\n      //è·å–æ–‡ä»¶\n      let formData = new FormData();\n      formData.append('file', file);\n      console.log(\"è·å–åˆ°çš„æ–‡ä»¶\" + formData);\n      //å‘èµ·è¯·æ±‚\n      var url = \"http://localhost:8989/fileShare/readQRCode\";\n      let config = {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n          'satoken': sessionStorage.getItem(\"saToken\")\n        }\n      };\n      console.log(config);\n      this.$http.post(url, formData, config).then(res => {\n        console.log(res);\n        let data = res.data;\n        //åŠ åˆ¤æ–­è¯­å¥\n        if (res.data.code !== 10000) {\n          //è‹¥å¤±è´¥ï¼Œç›´æ¥æç¤ºé”™è¯¯åŸå› \n          this.$message.error(res.data.message);\n        } else {\n          //æˆåŠŸ\n          this.$message.success(\"æå–æ–‡ä»¶\" + res.data.message);\n          console.log(this.fileInfo); //å¯ä»¥é€šè¿‡thisè·å–åˆ°dataä¸­çš„å†…å®¹\n          console.log(this.fileInfo.length);\n          this.fileInfo.push(res.data.data.fileInfo);\n          console.log(this.fileInfo);\n          console.log(this.fileInfo.length);\n        }\n      });\n    },\n    // å½“ç”¨æˆ·å‹¾é€‰è¡¨æ ¼è¡Œæ—¶è§¦å‘\n    handleSelectionChange(selection) {\n      this.selectedFiles = selection;\n    },\n    // ä¸‹è½½æ–‡ä»¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶\n    downloadFile() {\n      if (this.selectedFiles.length === 0) {\n        this.$message.warning('è¯·å…ˆå‹¾é€‰è¦ä¸‹è½½çš„æ–‡ä»¶');\n        return;\n      }\n\n      // éå†é€‰ä¸­çš„æ–‡ä»¶ï¼Œé€ä¸ªè§¦å‘æµè§ˆå™¨ä¸‹è½½\n      this.selectedFiles.forEach(file => {\n        // å…³é”®ï¼šç”¨ window.open è§¦å‘åŸç”Ÿä¸‹è½½\n        //window.open(file.downloadUrl, '_blank');\n        this.$axios.get(file.downloadUrl);\n      });\n    },\n    //æ–‡ä»¶ä¸‹è½½\n    // downloadFile(){\n    //   console.log(\"ä¸‹è½½æ–‡ä»¶æŒ‰é’®ç‚¹å‡»\");\n    //   var that = this;\n    //   for (var i=0;i<this.fileInfo.length;i++){\n    //     this.$axios.get(that.fileInfo[i].downloadUrl)\n    //   }\n    // }\n\n    // ğŸ‘‡ æ–°å¢ï¼šä»é“¾æ¥åŠ è½½æ–‡ä»¶\n    loadFromShareLink() {\n      if (!this.shareLink.trim()) {\n        this.$message.warning('è¯·è¾“å…¥åˆ†äº«é“¾æ¥');\n        return;\n      }\n\n      // ä» URL ä¸­æå– access_token\n      let token = '';\n      try {\n        const url = new URL(this.shareLink);\n        token = url.searchParams.get('access_token');\n      } catch (e) {\n        this.$message.error('é“¾æ¥æ ¼å¼æ— æ•ˆï¼Œè¯·è¾“å…¥å®Œæ•´çš„åˆ†äº«é“¾æ¥');\n        return;\n      }\n      if (!token) {\n        this.$message.error('é“¾æ¥ä¸­æœªæ‰¾åˆ° access_tokenï¼Œè¯·æ£€æŸ¥é“¾æ¥æ˜¯å¦æ­£ç¡®');\n        return;\n      }\n\n      // è°ƒç”¨åç«¯æ¥å£è·å–æ–‡ä»¶ä¿¡æ¯ï¼ˆéœ€åç«¯æ”¯æŒï¼‰\n      const url = `http://localhost:8989/fileShare/getSharedFileInfo?access_token=${token}`;\n      const config = {\n        headers: {\n          'satoken': sessionStorage.getItem(\"saToken\")\n        }\n      };\n      this.$http.get(url, config).then(res => {\n        if (res.data.code !== 10000) {\n          this.$message.error(res.data.message || 'æ— æ³•åŠ è½½åˆ†äº«å†…å®¹');\n        } else {\n          // å‡è®¾è¿”å›ç»“æ„ä¸º res.data.data.fileInfoï¼ˆä¸æ‰«ç æ¥å£ä¸€è‡´ï¼‰\n          const fileInfo = res.data.data.fileInfo;\n          // æ„é€  downloadUrlï¼ˆä¸æ‰«ç è¿”å›çš„ä¸€è‡´ï¼‰\n          fileInfo.downloadUrl = `http://localhost:8989/publicDownload?access_token=${token}`;\n          // æ·»åŠ åˆ°è¡¨æ ¼\n          this.fileInfo.push(fileInfo);\n          this.$message.success(`æˆåŠŸåŠ è½½æ–‡ä»¶ï¼š${fileInfo.fileName}`);\n        }\n      }).catch(err => {\n        console.error('åŠ è½½å¤±è´¥', err);\n        this.$message.error('ç½‘ç»œé”™è¯¯æˆ–é“¾æ¥å·²å¤±æ•ˆ');\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";AAiEA;EACAA;IACA;MACAC;MACAC;MACAC;MACAC;MACA;MACAC;IACA;EACA;;EACAC;IACAC;MACAC;IACA;IACAC;MACAD;IACA;IACAE;MACA;IACA;IACAC;MACA;IACA;IACAC,aAEA;IACAC;MAAA;MACAL;MACA;IACA;IACAM;MACA;MACAN;MACA;MACA;MACAO;MACAP;MACA;MACA;MACA;QACAQ;UACA;UACA;QACA;MACA;MACAR;MACA;QACAA;QACA;QACA;QACA;UAAA;UACA;QACA;UAAA;UACA;UACAA;UACAA;UACA;UACAA;UACAA;QACA;MACA;IACA;IACA;IACAS;MACA;IACA;IAEA;IACAC;MACA;QACA;QACA;MACA;;MAEA;MACA;QACA;QACA;QACA;MACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEA;IACAC;MACA;QACA;QACA;MACA;;MAEA;MACA;MACA;QACA;QACAC;MACA;QACA;QACA;MACA;MAEA;QACA;QACA;MACA;;MAEA;MACA;MACA;QACAJ;UACA;QACA;MACA;MAEA;QACA;UACA;QACA;UACA;UACA;UACA;UACAb;UACA;UACA;UACA;QACA;MACA;QACAK;QACA;MACA;IACA;EACA;AAGA","names":["data","tableData","fileList","fileInfo","selectedFiles","shareLink","methods","handleRemove","console","handlePreview","handleExceed","beforeRemove","saveShare","QRDecode","uploadFile","formData","headers","handleSelectionChange","downloadFile","loadFromShareLink","token"],"sourceRoot":"src/views/Receiveshare","sources":["Receiveshare.vue"],"sourcesContent":["<template>\r\n    <div>\r\n      <div class=\"header\">\r\n        <span class=\"title\">æ”¶åˆ°åˆ†äº«</span>\r\n      </div>\r\n      <div class=\"middle\">\r\n        <el-button class=\"receivebtn\" type=\"primary\" icon=\"el-icon-star-off\"\r\n                   @click=\"QRDecode()\">\r\n          æ‰«ç æ¥æ”¶\r\n        </el-button>\r\n        <el-button class=\"receivebtn\" type=\"primary\" icon=\"el-icon-star-off\"\r\n                   @click=\"downloadFile()\">\r\n          ä¸‹è½½æ–‡ä»¶\r\n        </el-button>\r\n\r\n        <!-- ğŸ‘‡ æ–°å¢ï¼šè¾“å…¥é“¾æ¥æ¥æ”¶ -->\r\n        <el-input\r\n            v-model=\"shareLink\"\r\n            placeholder=\"è¯·è¾“å…¥åˆ†äº«é“¾æ¥\"\r\n            style=\"width: 300px; margin-left: 10px;\"\r\n            size=\"small\"\r\n        ></el-input>\r\n        <el-button\r\n            type=\"success\"\r\n            icon=\"el-icon-link\"\r\n            size=\"small\"\r\n            style=\"margin-left: 5px;\"\r\n            @click=\"loadFromShareLink()\"\r\n        >\r\n          åŠ è½½é“¾æ¥\r\n        </el-button>\r\n        <input\r\n            id=\"file-selector\"\r\n            ref=\"uploadInput\"\r\n            type=\"file\"\r\n            @change=\"uploadFile\"\r\n            style=\"display: none\"/>\r\n      </div>\r\n      <div class=\"line\"></div>\r\n      <div class=\"body\">\r\n        <el-table\r\n          :data=\"fileInfo\"\r\n          height=\"550\"\r\n          stripe\r\n          border\r\n          style=\"width: 100%\"\r\n          ref=\"accountTable\"\r\n          @selection-change=\"handleSelectionChange\"\r\n        >\r\n          <el-table-column type=\"selection\" width=\"150\" align=\"center\"> </el-table-column>\r\n          <el-table-column prop=\"fileName\" label=\"åˆ†äº«æ–‡ä»¶å\" width=\"300\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column prop=\"fileType\" label=\"æ–‡ä»¶ç±»å‹\" width=\"150\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column prop=\"fileSize\" label=\"æ–‡ä»¶å¤§å°\" width=\"150\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column prop=\"ownerName\" label=\"åˆ†äº«äºº\" width=\"150\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column prop=\"downloadTimes\" label=\"ä¸‹è½½æ¬¡æ•°\" align=\"center\"> </el-table-column>\r\n        </el-table>\r\n      </div>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  export default {\r\n    data() {\r\n      return {\r\n        tableData: \"\",\r\n        fileList: '',\r\n        fileInfo: [],\r\n        selectedFiles: [],\r\n        // ğŸ‘‡ æ–°å¢\r\n        shareLink: '' // ç”¨äºç»‘å®šè¾“å…¥æ¡†\r\n      };\r\n    },\r\n    methods: {\r\n      handleRemove(file, fileList) {\r\n        console.log(file, fileList);\r\n      },\r\n      handlePreview(file) {\r\n        console.log(file);\r\n      },\r\n      handleExceed(files, fileList) {\r\n        this.$message.warning(`å½“å‰é™åˆ¶é€‰æ‹© 3 ä¸ªæ–‡ä»¶ï¼Œæœ¬æ¬¡é€‰æ‹©äº† ${files.length} ä¸ªæ–‡ä»¶ï¼Œå…±é€‰æ‹©äº† ${files.length + fileList.length} ä¸ªæ–‡ä»¶`);\r\n      },\r\n      beforeRemove(file, fileList) {\r\n        return this.$confirm(`ç¡®å®šç§»é™¤ ${ file.name }ï¼Ÿ`);\r\n      },\r\n      saveShare() {\r\n\r\n      },\r\n      QRDecode(){//æ‰«ç æ¥æ”¶\r\n        console.log(\"æ‰«ç æ¥æ”¶è¢«ç‚¹å‡»äº†\");\r\n        this.$refs.uploadInput.click();\r\n      },\r\n      uploadFile(e){\r\n        const file = e.target.files[0];\r\n        console.log(\"æ‰§è¡Œäº†uploadFileæ–¹æ³•\");\r\n        //è·å–æ–‡ä»¶\r\n        let formData = new FormData();\r\n        formData.append('file', file);\r\n        console.log(\"è·å–åˆ°çš„æ–‡ä»¶\" + formData);\r\n        //å‘èµ·è¯·æ±‚\r\n        var url = \"http://localhost:8989/fileShare/readQRCode\";\r\n        let config = {\r\n          headers:{\r\n            'Content-Type':'multipart/form-data',\r\n            'satoken':sessionStorage.getItem(\"saToken\")\r\n          }\r\n        }\r\n        console.log(config);\r\n        this.$http.post(url,formData,config).then(res=>{\r\n          console.log(res);\r\n          let data = res.data;\r\n          //åŠ åˆ¤æ–­è¯­å¥\r\n          if(res.data.code!==10000){//è‹¥å¤±è´¥ï¼Œç›´æ¥æç¤ºé”™è¯¯åŸå› \r\n            this.$message.error(res.data.message);\r\n          }else{//æˆåŠŸ\r\n            this.$message.success(\"æå–æ–‡ä»¶\" + res.data.message);\r\n            console.log(this.fileInfo);//å¯ä»¥é€šè¿‡thisè·å–åˆ°dataä¸­çš„å†…å®¹\r\n            console.log(this.fileInfo.length);\r\n            this.fileInfo.push(res.data.data.fileInfo);\r\n            console.log(this.fileInfo);\r\n            console.log(this.fileInfo.length);\r\n          }\r\n        })\r\n      },\r\n      // å½“ç”¨æˆ·å‹¾é€‰è¡¨æ ¼è¡Œæ—¶è§¦å‘\r\n      handleSelectionChange(selection) {\r\n        this.selectedFiles = selection;\r\n      },\r\n\r\n      // ä¸‹è½½æ–‡ä»¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶\r\n      downloadFile() {\r\n        if (this.selectedFiles.length === 0) {\r\n          this.$message.warning('è¯·å…ˆå‹¾é€‰è¦ä¸‹è½½çš„æ–‡ä»¶');\r\n          return;\r\n        }\r\n\r\n        // éå†é€‰ä¸­çš„æ–‡ä»¶ï¼Œé€ä¸ªè§¦å‘æµè§ˆå™¨ä¸‹è½½\r\n        this.selectedFiles.forEach(file => {\r\n          // å…³é”®ï¼šç”¨ window.open è§¦å‘åŸç”Ÿä¸‹è½½\r\n          //window.open(file.downloadUrl, '_blank');\r\n          this.$axios.get(file.downloadUrl)\r\n        });\r\n      },\r\n      //æ–‡ä»¶ä¸‹è½½\r\n      // downloadFile(){\r\n      //   console.log(\"ä¸‹è½½æ–‡ä»¶æŒ‰é’®ç‚¹å‡»\");\r\n      //   var that = this;\r\n      //   for (var i=0;i<this.fileInfo.length;i++){\r\n      //     this.$axios.get(that.fileInfo[i].downloadUrl)\r\n      //   }\r\n      // }\r\n\r\n      // ğŸ‘‡ æ–°å¢ï¼šä»é“¾æ¥åŠ è½½æ–‡ä»¶\r\n      loadFromShareLink() {\r\n        if (!this.shareLink.trim()) {\r\n          this.$message.warning('è¯·è¾“å…¥åˆ†äº«é“¾æ¥');\r\n          return;\r\n        }\r\n\r\n        // ä» URL ä¸­æå– access_token\r\n        let token = '';\r\n        try {\r\n          const url = new URL(this.shareLink);\r\n          token = url.searchParams.get('access_token');\r\n        } catch (e) {\r\n          this.$message.error('é“¾æ¥æ ¼å¼æ— æ•ˆï¼Œè¯·è¾“å…¥å®Œæ•´çš„åˆ†äº«é“¾æ¥');\r\n          return;\r\n        }\r\n\r\n        if (!token) {\r\n          this.$message.error('é“¾æ¥ä¸­æœªæ‰¾åˆ° access_tokenï¼Œè¯·æ£€æŸ¥é“¾æ¥æ˜¯å¦æ­£ç¡®');\r\n          return;\r\n        }\r\n\r\n        // è°ƒç”¨åç«¯æ¥å£è·å–æ–‡ä»¶ä¿¡æ¯ï¼ˆéœ€åç«¯æ”¯æŒï¼‰\r\n        const url = `http://localhost:8989/fileShare/getSharedFileInfo?access_token=${token}`;\r\n        const config = {\r\n          headers: {\r\n            'satoken': sessionStorage.getItem(\"saToken\")\r\n          }\r\n        };\r\n\r\n        this.$http.get(url, config).then(res => {\r\n          if (res.data.code !== 10000) {\r\n            this.$message.error(res.data.message || 'æ— æ³•åŠ è½½åˆ†äº«å†…å®¹');\r\n          } else {\r\n            // å‡è®¾è¿”å›ç»“æ„ä¸º res.data.data.fileInfoï¼ˆä¸æ‰«ç æ¥å£ä¸€è‡´ï¼‰\r\n            const fileInfo = res.data.data.fileInfo;\r\n            // æ„é€  downloadUrlï¼ˆä¸æ‰«ç è¿”å›çš„ä¸€è‡´ï¼‰\r\n            fileInfo.downloadUrl = `http://localhost:8989/publicDownload?access_token=${token}`;\r\n            // æ·»åŠ åˆ°è¡¨æ ¼\r\n            this.fileInfo.push(fileInfo);\r\n            this.$message.success(`æˆåŠŸåŠ è½½æ–‡ä»¶ï¼š${fileInfo.fileName}`);\r\n          }\r\n        }).catch(err => {\r\n          console.error('åŠ è½½å¤±è´¥', err);\r\n          this.$message.error('ç½‘ç»œé”™è¯¯æˆ–é“¾æ¥å·²å¤±æ•ˆ');\r\n        });\r\n      }\r\n    },\r\n\r\n\r\n  };\r\n  </script>\r\n  \r\n  <style lang=\"less\" scoped>\r\n  .header {\r\n    background-color: #dcdfe6;\r\n    height: 60px;\r\n    line-height: 60px;\r\n    display: flex;\r\n  }\r\n  .title {\r\n    color: #409eff;\r\n    float: left;\r\n    font-size: 30px;\r\n    margin-left: 20px;\r\n  }\r\n  .middle {\r\n    height: 50px;\r\n    line-height: 50px;\r\n    display: flex;\r\n  }\r\n  .receivebtn {\r\n    display: flex;\r\n    margin-left: 10px;\r\n    height: 80%;\r\n    margin-top: 5px;\r\n  }\r\n  .line {\r\n    height: 0;\r\n    width: 100%;\r\n    border: 1px solid #dcdfe6;\r\n  }\r\n  .body {\r\n    margin: 20px 10px;\r\n  }\r\n  </style>"]},"metadata":{},"sourceType":"module"}