{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  data() {\n    return {\n      show: false,\n      tableData: this.$global_msg.disk,\n      pathArr: [],\n      //点击分享按钮之后，值会变成blob的url地址，可以作为图片src进行返回\n      imgUrl: \"\",\n      dialogVisible: false,\n      fileUrl: ''\n    };\n  },\n  computed: {\n    //经过拼接的面包屑目录\n    pathString: function () {\n      var pstr = \"/\";\n      if (this.pathArr.length === 0) {\n        return pstr;\n      }\n      for (var i = 0; i < this.pathArr.length; i++) {\n        var tempStr = this.pathArr[i] + \"/\";\n        pstr += tempStr;\n      }\n      return pstr;\n    }\n  },\n  _methods: {\n    copy() {\n      var content = document.getElementById('textarea').innerHTML;\n      navigator.clipboard.writeText(content).then(() => {\n        this.$alert(\"复制成功！\");\n      }).catch(err => {\n        console.log('Something went wrong', err);\n      });\n    },\n    //返回上级目录\n    returnToLastDir() {\n      this.updateFolderSize();\n      if (this.pathArr.length === 0) {\n        this.$message.info(\"已经到达根目录\");\n        return;\n      }\n      this.pathArr.pop();\n      //todo:更新内容\n      var url = 'http://localhost:8989/getFilesAndFolders?path=' + this.pathString;\n      this.axios({\n        method: 'GET',\n        url: url\n      }).then(resp => {\n        let data = resp.data;\n        console.log(data);\n        if (data.success) {\n          this.tableData = data.data.fileList;\n        }\n      });\n    },\n    //点入文件夹\n    enterNextDir(row) {\n      this.updateFolderSize();\n      console.log(row);\n      var tempStr = row.fileName;\n      this.pathArr.push(tempStr);\n      //todo：更新内容\n      var url = 'http://localhost:8989/getFilesAndFolders?path=' + this.pathString;\n      this.axios({\n        method: 'GET',\n        url: url\n      }).then(resp => {\n        let data = resp.data;\n        console.log(data);\n        if (data.success) {\n          this.tableData = data.data.fileList;\n        }\n      });\n    },\n    //文件分享\n    shareFile(row) {\n      if (row.isfolder === 1) {\n        this.$message.warning(\"暂时不支持分享文件夹内容\");\n        return;\n      }\n      var that = this;\n      //请求token，由于异步的关系，在弹窗弹出来之前要改完数据，所有这段放前面，收图片肯定比收字符串慢\n\n      // this.$loading(\"loading\");//显示正在加载\n      //接下来的逻辑为，发起请求，成功加载/加载失败\n      console.log(sessionStorage.getItem(\"saToken\"));\n      var url = \"http://localhost:8989/fileShare/createQRCode1?fileId=\" + row.id;\n      this.$axios({\n        url: url,\n        method: \"GET\",\n        headers: {\n          'satoken': sessionStorage.getItem(\"saToken\")\n        },\n        responseType: \"blob\"\n      }).then(function (res) {\n        console.log(\"请求发起成功\");\n        console.log(res);\n        var typeArray = res.data;\n        var blob = new Blob([typeArray], {\n          type: res.headers['Content-Type']\n        });\n        var url = window.URL.createObjectURL(blob);\n        while (1) {\n          console.log(\"还未获得url\");\n          if (url != '') {\n            console.log(\"获得url了\");\n            console.log(url);\n            that.imgUrl = url;\n            that.$axios({\n              url: \"http://localhost:8989/getShareCode?fileId=\" + row.id,\n              method: \"GET\",\n              headers: {\n                'satoken': sessionStorage.getItem(\"saToken\")\n              }\n            }).then(res => {\n              console.log(res);\n              var token = res.data.data[\"access_token\"];\n              that.fileUrl = \"http://loaclhost:8989/publicDownload?access_token=\" + token;\n              that.dialogVisible = true;\n            });\n            break;\n          }\n        }\n        // var imgHtmlString = \"<image src='\" + url + \"'>\";\n        //弹窗\n        // that.$alert('<strong>您的分享二维码：</strong>' +\n        //     \"<image width='390' height='200' src='\" + url + \"'>\" +\n        //     '<strong>您的文件下载地址：</strong>', '分享详情', {\n        //   dangerouslyUseHTMLString: true\n        // });\n      });\n    },\n\n    // 文件夹或文件重命名\n    handleEdit_(row) {\n      this.$prompt('修改文件名', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消'\n      }).then(({\n        value\n      }) => {\n        if (value == null) {\n          this.$message({\n            type: 'info',\n            message: \"输入不能为空\"\n          });\n          return;\n        }\n        this.axios({\n          method: 'PUT',\n          url: 'http://localhost:8989/rename',\n          data: {\n            folderId: row.id,\n            newFolderName: value\n          }\n        }).then(resp => {\n          let data = resp.data;\n          if (data.success) {\n            this.getFileAndFolder();\n            this.$message({\n              type: 'success',\n              message: data.message\n            });\n          } else {\n            this.$message({\n              type: 'info',\n              message: data.message\n            });\n          }\n        });\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '取消输入'\n        });\n      });\n    },\n    //移动文件夹或文件\n    moveFile(row) {\n      console.log(row);\n      this.$prompt('输入要移动的路径，格式: /**/**/', '移动到', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消'\n      }).then(({\n        value\n      }) => {\n        if (value == null) {\n          this.$message({\n            type: 'info',\n            message: \"输入不能为空\"\n          });\n          return;\n        }\n        if (this.pathString == value) {\n          this.$message({\n            type: 'info',\n            message: \"已在当前文件夹\"\n          });\n          return;\n        }\n        this.axios({\n          method: 'PUT',\n          url: 'http://localhost:8989/move',\n          data: {\n            folderId: row.id,\n            newPath: value\n          }\n        }).then(resp => {\n          let data = resp.data;\n          if (data.success) {\n            this.getFileAndFolder();\n            this.$message({\n              type: 'success',\n              message: data.message\n            });\n          } else {\n            this.$message({\n              type: 'info',\n              message: data.message\n            });\n          }\n        });\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '取消输入'\n        });\n      });\n    },\n    updateFolderSize() {\n      this.axios({\n        method: 'GET',\n        url: 'http://localhost:8989/getFolderSize?path=' + this.pathString\n      });\n    },\n    // 获取路径下文件和文件夹\n    getFileAndFolder() {\n      var url = 'http://localhost:8989/getFilesAndFolders?path=' + this.pathString;\n      this.axios({\n        method: 'GET',\n        url: url\n      }).then(resp => {\n        let data = resp.data;\n        console.log(data);\n        if (data.success) {\n          this.tableData = data.data.fileList;\n        }\n      });\n    },\n    // 创建文件夹\n    createDir() {\n      this.$prompt('输入文件夹目录', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消'\n      }).then(({\n        value\n      }) => {\n        if (value == null) {\n          this.$message({\n            type: 'info',\n            message: \"输入不能为空\"\n          });\n          return;\n        }\n        this.axios({\n          method: 'POST',\n          url: 'http://localhost:8989/createFolder',\n          data: {\n            path: this.pathString,\n            folderName: value\n          }\n        }).then(resp => {\n          let data = resp.data;\n          if (data.success) {\n            this.getFileAndFolder();\n            this.$message({\n              type: 'success',\n              message: data.message\n            });\n          } else {\n            this.$message({\n              type: 'info',\n              message: data.message\n            });\n          }\n        });\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '取消输入'\n        });\n      });\n    },\n    // 删除文件夹或文件\n    deleteFile_(row, index) {\n      if (confirm(\"是否删除！\")) {\n        this.axios({\n          method: 'DELETE',\n          url: 'http://localhost:8989/delete',\n          data: {\n            fileId: row.id\n          }\n        }).then(resp => {\n          let data = resp.data;\n          if (data.success) {\n            this.tableData.splice(index, 1);\n            this.$message({\n              type: 'success',\n              message: data.message\n            });\n          } else {\n            this.$message({\n              type: 'info',\n              message: data.message\n            });\n          }\n        });\n      } else {\n        this.$message({\n          type: 'info',\n          message: '取消删除'\n        });\n      }\n    },\n    getFile(event) {\n      this.file = event.target.files[0];\n      console.log(this.file);\n    },\n    submitForm(event) {\n      event.preventDefault();\n      let formData = new FormData();\n      formData.append('ifile', this.file);\n      formData.append(\"path\", this.pathString);\n      let config = {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n          \"satoken\": sessionStorage.getItem(\"satoken\")\n        }\n      };\n      console.log(config);\n      var url = \"http://localhost:8989/upload\";\n      this.$http.post(url, formData, config).then(res => {\n        console.log(res);\n        let data = res.data;\n        if (data.code !== 10000) {\n          this.$message.error(data.message);\n        } else {\n          this.getFileAndFolder();\n          this.$message({\n            message: \"上传成功\",\n            type: \"success\"\n          });\n        }\n      });\n    },\n    download(row) {\n      let that = this;\n      console.log(row);\n      let headers = {\n        'Content-Type': 'multipart/form-data',\n        \"satoken\": sessionStorage.getItem(\"satoken\")\n      };\n      var fileId = row.id;\n      var filename = row.fileName;\n      // let url=\"http://localhost:8989/download?fileId=\"+fileId\n      // window.open(url, \"_blank\")\n      this.axios({\n        url: \"http://localhost:8989/download\",\n        method: \"GET\",\n        headers: headers,\n        params: {\n          fileId: fileId\n        }\n      }).then(res => {\n        console.log(res);\n        that.$message({\n          message: \"请求成功\",\n          type: \"success\"\n        });\n        let blob = new Blob([res.data]);\n        let downloadElement = document.createElement(\"a\");\n        let href = window.URL.createObjectURL(blob); //创建下载的链接\n        downloadElement.href = href;\n        downloadElement.download = filename; //下载后文件名\n        document.body.appendChild(downloadElement);\n        downloadElement.click(); //点击下载\n        document.body.removeChild(downloadElement); //下载完成移除元素\n        window.URL.revokeObjectURL(href); //释放掉blob对象\n      }).catch(function (error) {\n        if (error.response.status == 400) {\n          that.$message({\n            message: \"文件不存在\",\n            type: \"error\"\n          });\n        } else if (error.response.status == 500) {\n          that.$message({\n            message: \"抱歉，文件已丢失\",\n            type: \"error\"\n          });\n        }\n      });\n    }\n  },\n  get methods() {\n    return this._methods;\n  },\n  set methods(value) {\n    this._methods = value;\n  }\n};","map":{"version":3,"mappings":";AA+DA;EACAA;IACA;MACAC;MACAC;MACAC;MACA;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;IACAC;MACA;MACA;QACA;MACA;MACA;QACA;QACAC;MACA;MACA;IACA;EACA;EAEAC;IACAC;MACA;MAEAC,uCACAC;QACA;MACA,GACAC;QACAC;MACA;IACA;IAEA;IACAC;MACA;MACA;QACA;QACA;MACA;MACA;MACA;MACA;MACA;QACAC;QACAC;MACA;QACA;QACAH;QACA;UACA;QACA;MACA;IACA;IAEA;IACAI;MACA;MACAJ;MACA;MACA;MACA;MACA;MACA;QACAE;QACAC;MACA;QACA;QACAH;QACA;UACA;QACA;MACA;IACA;IAEA;IACAK;MAEA;QACA;QACA;MACA;MACA;MACA;;MAEA;MACA;MACAL;MACA;MACA;QACAG;QACAD;QACAI;UACA;QACA;QACAC;MACA;QACAP;QACAA;QACA;QACA;UAAAQ;QAAA;QACA;QACA;UACAR;UACA;YACAA;YACAA;YACAS;YACAA;cACAN;cACAD;cACAI;gBACA;cACA;YACA;cACAN;cACA;cACAS;cACAA;YACA;YACA;UACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MAEA;IAEA;;IAEA;IACAC;MACA;QACAC;QACAC;MACA;QAAAC;MAAA;QACA;UACA;YACAL;YACAM;UACA;UACA;QACA;QACA;UACAZ;UACAC;UACAlB;YACA8B;YACAC;UACA;QACA;UACA;UACA;YACA;YACA;cACAR;cACAM;YACA;UACA;YACA;cACAN;cACAM;YACA;UACA;QACA;MACA;QACA;UACAN;UACAM;QACA;MACA;IACA;IAGA;IACAG;MACAjB;MACA;QACAW;QACAC;MACA;QAAAC;MAAA;QACA;UACA;YACAL;YACAM;UACA;UACA;QACA;QACA;UACA;YACAN;YACAM;UACA;UACA;QACA;QACA;UACAZ;UACAC;UACAlB;YACA8B;YACAG;UACA;QACA;UACA;UACA;YACA;YACA;cACAV;cACAM;YACA;UACA;YACA;cACAN;cACAM;YACA;UACA;QACA;MACA;QACA;UACAN;UACAM;QACA;MACA;IACA;IAEAK;MACA;QACAjB;QACAC;MACA;IACA;IAEA;IACAiB;MACA;MACA;QACAlB;QACAC;MACA;QACA;QACAH;QACA;UACA;QACA;MACA;IACA;IAEA;IACAqB;MACA;QACAV;QACAC;MACA;QAAAC;MAAA;QACA;UACA;YACAL;YACAM;UACA;UACA;QACA;QACA;UACAZ;UACAC;UACAlB;YACAqC;YACAC;UACA;QACA;UACA;UACA;YACA;YACA;cACAf;cACAM;YACA;UACA;YACA;cACAN;cACAM;YACA;UACA;QACA;MACA;QACA;UACAN;UACAM;QACA;MACA;IACA;IAEA;IACAU;MACA;QACA;UACAtB;UACAC;UACAlB;YACAwC;UACA;QACA;UACA;UACA;YACA;YACA;cACAjB;cACAM;YACA;UACA;YACA;cACAN;cACAM;YACA;UACA;QACA;MACA;QACA;UACAN;UACAM;QACA;MACA;IACA;IAGAY;MACA;MACA1B;IACA;IAEA2B;MACAC;MACA;MACAC;MACAA;MAEA;QACAvB;UACA;UACA;QACA;MACA;MACAN;MACA;MACA;QACAA;QACA;QACA;UACA;QACA;UACA;UACA;YACAc;YACAN;UACA;QACA;MACA;IACA;IAEAsB;MACA;MACA9B;MACA;QACA;QACA;MACA;MACA;MACA;MACA;MACA;MACA;QACAG;QACAD;QACAI;QACAyB;UACAN;QACA;MACA;QACAzB;QACAS;UACAK;UACAN;QACA;QACA;QACA;QACA;QACAwB;QACAA;QACAC;QACAD;QACAC;QACAC;MACA;QACA;UACAzB;YACAK;YACAN;UACA;QACA,OACA;UACAC;YACAK;YACAN;UACA;QACA;MACA;IAEA;EACA;EAEA;IACA;EACA;EACA;IACA;EACA;AACA","names":["data","show","tableData","pathArr","imgUrl","dialogVisible","fileUrl","computed","pathString","pstr","_methods","copy","navigator","then","catch","console","returnToLastDir","method","url","enterNextDir","shareFile","headers","responseType","type","that","handleEdit_","confirmButtonText","cancelButtonText","value","message","folderId","newFolderName","moveFile","newPath","updateFolderSize","getFileAndFolder","createDir","path","folderName","deleteFile_","fileId","getFile","submitForm","event","formData","download","params","downloadElement","document","window"],"sourceRoot":"src/views/Mydisk","sources":["Mydisk.vue"],"sourcesContent":["<template>\r\n    <div class=\"mydisk\">\r\n        <el-dialog\r\n          title=\"分享详情\"\r\n          :visible.sync=\"dialogVisible\"\r\n          width=\"30%\">\r\n          <strong>您的分享二维码：</strong>\r\n<!--          <image width='390' height='200' :src=\"imgUrl\"/>-->\r\n<!--          <image src=\"F://wallhaven/bg.jpg\"></image>-->\r\n          <img :src=\"imgUrl\" class=\"dialogImg\">\r\n\r\n          <strong><br>您的文件下载地址：</strong>\r\n          <textarea id=\"textarea\" cols=\"25\" rows=\"1\" v-model=\"fileUrl\"></textarea>\r\n          <span slot=\"footer\" class=\"dialog-footer\">\r\n            <el-button @click=\"copy\">复制</el-button>\r\n            <el-button type=\"primary\" @click=\"dialogVisible = false\">确 定</el-button>\r\n          </span>\r\n        </el-dialog>\r\n        <!-- 按钮区域 -->\r\n<!--        <el-image :src=\"imgUrl\"></el-image>-->\r\n        <div class=\"header\">\r\n            <!-- <el-button type=\"danger\" >上传文件</el-button> -->\r\n            <form style=\"heigth: 40px\">\r\n                <input type=\"file\" class=\"input1_\" @change=\"getFile($event)\">\r\n                <button class=\"btn1_\" @click=\"submitForm($event)\">提交</button>\r\n            </form>\r\n\r\n            <el-button type=\"primary\" @click=\"createDir\" style=\"margin-left: 30px\">创建文件夹</el-button>\r\n<!--            <el-button type=\"info\" @click=\"deleteFile\">删除</el-button>-->\r\n<!--            <el-button type=\"primary\" @click=\"shareFiles\">分享</el-button>-->\r\n            <el-button type=\"primary\" @click=\"returnToLastDir()\">返回上级</el-button>\r\n<!--            <el-button type=\"primary\"></el-button>-->\r\n        </div>\r\n<!--        展现面包屑-->\r\n        <div class=\"bread\">\r\n          当前路径：{{pathString}}\r\n        </div>\r\n      <!-- 表格区域展示视图数据 -->\r\n        <div class=\"wrapper\">\r\n            <el-table :data=\"tableData\" border ref=\"accountTable\" style=\"width:100%\">\r\n<!--                <el-table-column type=\"\" width=\"100\"> </el-table-column>-->\r\n                <el-table-column v-if=\"show\" prop=\"id\" label=\"id\" width=\"200\" style=\"padding: 0\"></el-table-column>\r\n              <el-table-column prop=\"fileImg\" label=\"\" width=\"50\"></el-table-column>\r\n                <el-table-column prop=\"fileName\" label=\"文件名\" width=\"200\"></el-table-column>\r\n                <el-table-column prop=\"fileSize\" label=\"大小(KB)\" width=\"200\"></el-table-column>\r\n                <el-table-column prop=\"uploadTime\" label=\"上传时间\" width=\"200\"> </el-table-column>\r\n                <el-table-column label=\"操作\" width=\"500\">\r\n                  <template slot-scope=\"scope\">\r\n                    <el-button size=\"mini\" v-if=\"scope.row.isfolder===1\" @click=\"enterNextDir(scope.row)\">进入</el-button>\r\n                    <el-button size=\"mini\" v-if=\"scope.row.isfolder===0\" @click=\"download(scope.row)\">下载</el-button>\r\n                    <el-button size=\"mini\" @click=\"shareFile(scope.row)\">分享</el-button>\r\n                    <el-button size=\"mini\" @click=\"handleEdit_(scope.row)\">重命名</el-button>\r\n                    <el-button size=\"mini\" @click=\"moveFile(scope.row)\">移动</el-button>\r\n                    <el-button size=\"mini\" type=\"danger\" @click=\"deleteFile_(scope.row, scope.$index)\">删除</el-button>\r\n                  </template>\r\n                </el-table-column>\r\n            </el-table>\r\n        </div>\r\n        <!-- 分页 -->\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    export default {\r\n        data() {\r\n            return{\r\n              show:false,\r\n              tableData: this.$global_msg.disk,\r\n              pathArr:[],\r\n              //点击分享按钮之后，值会变成blob的url地址，可以作为图片src进行返回\r\n              imgUrl: \"\", \r\n              dialogVisible: false,\r\n              fileUrl:''\r\n            };\r\n        },\r\n        computed:{\r\n          //经过拼接的面包屑目录\r\n          pathString:function (){\r\n            var pstr = \"/\";\r\n            if(this.pathArr.length===0){\r\n              return pstr;\r\n            }\r\n            for(var i = 0;i<this.pathArr.length;i++){\r\n              var tempStr = this.pathArr[i] + \"/\";\r\n              pstr += tempStr;\r\n            }\r\n            return pstr;\r\n          }\r\n        },\r\n\r\n      _methods: {\r\n        copy(){\r\n          var content = document.getElementById('textarea').innerHTML;\r\n\r\n          navigator.clipboard.writeText(content)\r\n          .then(() => {\r\n            this.$alert(\"复制成功！\")\r\n          })\r\n          .catch(err => {\r\n          console.log('Something went wrong', err);\r\n          })\r\n        },\r\n\r\n        //返回上级目录\r\n        returnToLastDir(){\r\n          this.updateFolderSize()\r\n          if(this.pathArr.length===0){\r\n            this.$message.info(\"已经到达根目录\")\r\n            return;\r\n          }\r\n          this.pathArr.pop();\r\n          //todo:更新内容\r\n          var url = 'http://localhost:8989/getFilesAndFolders?path=' + this.pathString;\r\n          this.axios({\r\n            method:'GET',\r\n            url: url,\r\n          }).then((resp)=>{\r\n            let data = resp.data;\r\n            console.log(data)\r\n            if (data.success) {\r\n              this.tableData = data.data.fileList;\r\n            }\r\n          })\r\n        },\r\n\r\n        //点入文件夹\r\n        enterNextDir(row){\r\n          this.updateFolderSize()\r\n          console.log(row);\r\n          var tempStr = row.fileName;\r\n          this.pathArr.push(tempStr);\r\n          //todo：更新内容\r\n          var url = 'http://localhost:8989/getFilesAndFolders?path=' + this.pathString;\r\n          this.axios({\r\n            method:'GET',\r\n            url: url,\r\n          }).then((resp)=>{\r\n            let data = resp.data;\r\n            console.log(data)\r\n            if (data.success) {\r\n              this.tableData = data.data.fileList;\r\n            }\r\n          })\r\n        },\r\n\r\n        //文件分享\r\n        shareFile(row){\r\n\r\n          if(row.isfolder===1){\r\n            this.$message.warning(\"暂时不支持分享文件夹内容\")\r\n            return;\r\n          }\r\n          var that = this;\r\n          //请求token，由于异步的关系，在弹窗弹出来之前要改完数据，所有这段放前面，收图片肯定比收字符串慢\r\n\r\n          // this.$loading(\"loading\");//显示正在加载\r\n          //接下来的逻辑为，发起请求，成功加载/加载失败\r\n          console.log(sessionStorage.getItem(\"saToken\"));\r\n          var url = \"http://localhost:8989/fileShare/createQRCode1?fileId=\" + row.id;\r\n          this.$axios({\r\n            url:url,\r\n            method:\"GET\",\r\n            headers:{\r\n              'satoken':sessionStorage.getItem(\"saToken\")\r\n            },\r\n            responseType:\"blob\"\r\n          }).then(function (res){\r\n            console.log(\"请求发起成功\");\r\n            console.log(res);\r\n            var typeArray = res.data;\r\n            var blob = new Blob([typeArray],{type:res.headers['Content-Type']});\r\n            var url = window.URL.createObjectURL(blob);\r\n            while(1){\r\n              console.log(\"还未获得url\");\r\n              if(url!=''){\r\n                console.log(\"获得url了\");\r\n                console.log(url);\r\n                that.imgUrl = url;\r\n                that.$axios({\r\n                  url:\"http://localhost:8989/getShareCode?fileId=\"+row.id,\r\n                  method:\"GET\",\r\n                  headers:{\r\n                    'satoken':sessionStorage.getItem(\"saToken\")\r\n                  },\r\n                }).then(res=>{\r\n                  console.log(res)\r\n                  var token=res.data.data[\"access_token\"]\r\n                  that.fileUrl=\"http://loaclhost:8989/publicDownload?access_token=\"+token\r\n                  that.dialogVisible=true\r\n                })\r\n                break;\r\n              }\r\n            }\r\n            // var imgHtmlString = \"<image src='\" + url + \"'>\";\r\n            //弹窗\r\n            // that.$alert('<strong>您的分享二维码：</strong>' +\r\n            //     \"<image width='390' height='200' src='\" + url + \"'>\" +\r\n            //     '<strong>您的文件下载地址：</strong>', '分享详情', {\r\n            //   dangerouslyUseHTMLString: true\r\n            // });\r\n\r\n          })\r\n          \r\n        },\r\n\r\n        // 文件夹或文件重命名\r\n        handleEdit_(row) {\r\n          this.$prompt('修改文件名', '提示', {\r\n            confirmButtonText: '确定',\r\n            cancelButtonText: '取消',\r\n          }).then(({ value }) => {\r\n            if(value == null){\r\n              this.$message({\r\n                type: 'info',\r\n                message: \"输入不能为空\"\r\n              });\r\n              return;\r\n            }\r\n            this.axios({\r\n              method:'PUT',\r\n              url:'http://localhost:8989/rename',\r\n              data:{\r\n                folderId: row.id,\r\n                newFolderName: value\r\n              },\r\n            }).then((resp) => {\r\n              let data=resp.data;\r\n              if(data.success) {\r\n                this.getFileAndFolder()\r\n                this.$message({\r\n                  type: 'success',\r\n                  message: data.message\r\n                });\r\n              } else {\r\n                this.$message({\r\n                  type: 'info',\r\n                  message: data.message\r\n                });\r\n              }\r\n            });\r\n          }).catch(() => {\r\n            this.$message({\r\n              type: 'info',\r\n              message: '取消输入'\r\n            });\r\n          });\r\n        },\r\n\r\n\r\n        //移动文件夹或文件\r\n        moveFile(row) {\r\n            console.log(row);\r\n            this.$prompt('输入要移动的路径，格式: /**/**/', '移动到', {\r\n              confirmButtonText: '确定',\r\n              cancelButtonText: '取消',\r\n            }).then(({ value }) => {\r\n              if(value == null){\r\n                this.$message({\r\n                  type: 'info',\r\n                  message: \"输入不能为空\"\r\n                });\r\n                return;\r\n              }\r\n              if(this.pathString == value){\r\n                this.$message({\r\n                  type: 'info',\r\n                  message: \"已在当前文件夹\"\r\n                });\r\n                return;\r\n              }\r\n              this.axios({\r\n                method:'PUT',\r\n                url:'http://localhost:8989/move',\r\n                data:{\r\n                  folderId: row.id,\r\n                  newPath: value\r\n                },\r\n              }).then((resp) => {\r\n                let data=resp.data;\r\n                if(data.success) {\r\n                  this.getFileAndFolder()\r\n                  this.$message({\r\n                    type: 'success',\r\n                    message: data.message\r\n                  });\r\n                } else {\r\n                  this.$message({\r\n                    type: 'info',\r\n                    message: data.message\r\n                  });\r\n                }\r\n              });\r\n            }).catch(() => {\r\n              this.$message({\r\n                type: 'info',\r\n                message: '取消输入'\r\n              });\r\n            });\r\n        },\r\n\r\n        updateFolderSize() {\r\n          this.axios({\r\n            method:'GET',\r\n            url:'http://localhost:8989/getFolderSize?path='+this.pathString,\r\n          })\r\n        },\r\n\r\n        // 获取路径下文件和文件夹\r\n        getFileAndFolder() {\r\n          var url = 'http://localhost:8989/getFilesAndFolders?path=' + this.pathString;\r\n          this.axios({\r\n            method:'GET',\r\n            url: url,\r\n          }).then((resp)=>{\r\n            let data = resp.data;\r\n            console.log(data)\r\n            if (data.success) {\r\n              this.tableData = data.data.fileList;\r\n            }\r\n          })\r\n        },\r\n\r\n        // 创建文件夹\r\n        createDir() {\r\n          this.$prompt('输入文件夹目录', '提示', {\r\n            confirmButtonText: '确定',\r\n            cancelButtonText: '取消',\r\n          }).then(({ value }) => {\r\n            if(value == null){\r\n              this.$message({\r\n                type: 'info',\r\n                message: \"输入不能为空\"\r\n              });\r\n              return;\r\n            }\r\n            this.axios({\r\n              method:'POST',\r\n              url:'http://localhost:8989/createFolder',\r\n              data:{\r\n                path: this.pathString,\r\n                folderName: value\r\n              }\r\n            }).then((resp) => {\r\n              let data=resp.data;\r\n              if(data.success) {\r\n                this.getFileAndFolder()\r\n                this.$message({\r\n                  type: 'success',\r\n                  message: data.message\r\n                });\r\n              } else {\r\n                this.$message({\r\n                  type: 'info',\r\n                  message: data.message\r\n                });\r\n              }\r\n            });\r\n          }).catch(() => {\r\n            this.$message({\r\n              type: 'info',\r\n              message: '取消输入'\r\n            });\r\n          });\r\n        },\r\n\r\n        // 删除文件夹或文件\r\n        deleteFile_(row, index) {\r\n          if(confirm(\"是否删除！\")) {\r\n            this.axios({\r\n              method:'DELETE',\r\n              url:'http://localhost:8989/delete',\r\n              data:{\r\n                fileId: row.id\r\n              }\r\n            }).then((resp) => {\r\n              let data=resp.data;\r\n              if(data.success) {\r\n                this.tableData.splice(index,1)\r\n                this.$message({\r\n                  type: 'success',\r\n                  message: data.message\r\n                });\r\n              } else {\r\n                this.$message({\r\n                  type: 'info',\r\n                  message: data.message\r\n                });\r\n              }\r\n            });\r\n          }else {\r\n            this.$message({\r\n              type: 'info',\r\n              message: '取消删除'\r\n            });\r\n          }\r\n        },\r\n\r\n\r\n        getFile(event) {\r\n          this.file=event.target.files[0];\r\n          console.log(this.file);\r\n        },\r\n\r\n        submitForm(event) {\r\n          event.preventDefault();\r\n          let formData=new FormData();\r\n          formData.append('ifile', this.file);\r\n          formData.append(\"path\", this.pathString)\r\n\r\n          let config={\r\n            headers:{\r\n              'Content-Type': 'multipart/form-data',\r\n              \"satoken\": sessionStorage.getItem(\"satoken\")\r\n            }\r\n          }\r\n          console.log(config)\r\n          var url=\"http://localhost:8989/upload\"\r\n          this.$http.post(url, formData, config).then(res=>{\r\n            console.log(res)\r\n            let data=res.data\r\n            if(data.code!==10000){\r\n              this.$message.error(data.message)\r\n            } else {\r\n              this.getFileAndFolder()\r\n              this.$message({\r\n                message: \"上传成功\",\r\n                type: \"success\"\r\n              })\r\n            }\r\n          })\r\n        },\r\n\r\n        download(row) {\r\n          let that=this\r\n          console.log(row)\r\n          let headers={\r\n            'Content-Type': 'multipart/form-data',\r\n            \"satoken\": sessionStorage.getItem(\"satoken\")\r\n          }\r\n          var fileId=row.id\r\n          var filename=row.fileName\r\n          // let url=\"http://localhost:8989/download?fileId=\"+fileId\r\n          // window.open(url, \"_blank\")\r\n          this.axios({\r\n            url: \"http://localhost:8989/download\",\r\n            method: \"GET\",\r\n            headers: headers,\r\n            params: {\r\n              fileId: fileId\r\n            },\r\n          }).then(res=>{\r\n            console.log(res)\r\n            that.$message({\r\n              message: \"请求成功\",\r\n              type: \"success\"\r\n            })\r\n            let blob = new Blob([res.data]);\r\n            let downloadElement = document.createElement(\"a\");\r\n            let href = window.URL.createObjectURL(blob); //创建下载的链接\r\n            downloadElement.href = href;\r\n            downloadElement.download = filename; //下载后文件名\r\n            document.body.appendChild(downloadElement);\r\n            downloadElement.click(); //点击下载\r\n            document.body.removeChild(downloadElement); //下载完成移除元素\r\n            window.URL.revokeObjectURL(href); //释放掉blob对象\r\n          }).catch(function(error){\r\n            if (error.response.status==400){\r\n              that.$message({\r\n                message: \"文件不存在\",\r\n                type: \"error\"\r\n              })\r\n            }\r\n            else if (error.response.status==500){\r\n              that.$message({\r\n                message: \"抱歉，文件已丢失\",\r\n                type: \"error\"\r\n              })\r\n            }\r\n          })\r\n\r\n        }\r\n      },\r\n      \r\n      get methods() {\r\n        return this._methods;\r\n      },\r\n      set methods(value) {\r\n        this._methods=value;\r\n      },\r\n    }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.mydisk{\r\n    margin-left: 0px;\r\n}\r\n.header{\r\n    display: flex;\r\n    margin-top: 10px;\r\n    margin-left: 20px;\r\n}\r\n\r\n.bread{\r\n  display: flex;\r\n  margin-left: 20px;\r\n  margin-top: 20px;\r\n}\r\n\r\n.wrapper{\r\n    margin: 10px 20px;\r\n}\r\n\r\n.input1_ {\r\n    width: 150px;\r\n}\r\n.btn1_ {\r\n    background-color: #409EFF;\r\n    border: 0px;\r\n    height: 30px;\r\n    border-radius: 8px;\r\n    color: white;\r\n    width: 50px;\r\n}\r\n\r\n.dialogImg{\r\n  width: 80%;\r\n  //margin-left: 5%;\r\n  height: 60%;\r\n  margin-bottom: 5%;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}